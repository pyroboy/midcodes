var At=Object.defineProperty;var Tt=(t,e,n)=>e in t?At(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Ye=(t,e,n)=>Tt(t,typeof e!="symbol"?e+"":e,n);import{s as ke,C as Re,D as $e,E as ht,F as _t,G as pt,H as bt,a as T,f as U,g as j,d as R,k as w,i as F,n as fe,S as vt,o as Ve,P as wt,_ as Ut,M as Se,b as H,j as z,U as Ge,l as D,y as oe,A as He,c as Te,p as ue,a3 as qe,a4 as Lt,r as $t,e as ce,t as _e,h as pe,m as ze,z as yt,v as Ke}from"../chunks/scheduler.Bl--k1HL.js";import{S as De,i as Oe,c as W,a as Y,m as G,t as $,b as M,d as q,g as Xe,e as We}from"../chunks/index.DR8de1tj.js";import{e as Ee,u as Mt,o as Ft}from"../chunks/each.En5UpT5R.js";import{p as Pt}from"../chunks/stores.Cq8_Q5sV.js";import{u as jt,s as Bt}from"../chunks/auth.Curs6txW.js";import"../chunks/index.D4E8IgGl.js";import{C as Ze}from"../chunks/card.Di3vQaZg.js";import{L as Vt}from"../chunks/label.BX-RGDB2.js";import{R as Ht,S as zt,a as Xt,V as Wt,b as Yt}from"../chunks/index.BkiOxIzK.js";import{w as Gt}from"../chunks/index.CtH2YV38.js";import{g as Rt,a as Et}from"../chunks/spread.CgU5AtxT.js";import{I as Ct}from"../chunks/Icon.X1g8dxaz.js";import{g as qt}from"../chunks/entry.B5jMEGBp.js";import{e as Kt}from"../chunks/forms.BAKYq1CP.js";import{B as Zt}from"../chunks/button.BqeWxtk_.js";import{L as Jt}from"../chunks/loader.DWsVpGN2.js";const Qt=!0,Fe=Qt;function xt(t){let e;const n=t[2].default,a=ht(n,t,t[3],null);return{c(){a&&a.c()},l(i){a&&a.l(i)},m(i,r){a&&a.m(i,r),e=!0},p(i,r){a&&a.p&&(!e||r&8)&&_t(a,n,i,i[3],e?bt(n,i[3],r,null):pt(i[3]),null)},i(i){e||($(a,i),e=!0)},o(i){M(a,i),e=!1},d(i){a&&a.d(i)}}}function en(t){let e,n;const a=[{name:"move"},t[1],{iconNode:t[0]}];let i={$$slots:{default:[xt]},$$scope:{ctx:t}};for(let r=0;r<a.length;r+=1)i=Re(i,a[r]);return e=new Ct({props:i}),{c(){W(e.$$.fragment)},l(r){Y(e.$$.fragment,r)},m(r,l){G(e,r,l),n=!0},p(r,[l]){const o=l&3?Rt(a,[a[0],l&2&&Et(r[1]),l&1&&{iconNode:r[0]}]):{};l&8&&(o.$$scope={dirty:l,ctx:r}),e.$set(o)},i(r){n||($(e.$$.fragment,r),n=!0)},o(r){M(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function tn(t,e,n){let{$$slots:a={},$$scope:i}=e;const r=[["path",{d:"M12 2v20"}],["path",{d:"m15 19-3 3-3-3"}],["path",{d:"m19 9 3 3-3 3"}],["path",{d:"M2 12h20"}],["path",{d:"m5 9-3 3 3 3"}],["path",{d:"m9 5 3-3 3 3"}]];return t.$$set=l=>{n(1,e=Re(Re({},e),$e(l))),"$$scope"in l&&n(3,i=l.$$scope)},e=$e(e),[r,e,a,i]}class nn extends De{constructor(e){super(),Oe(this,e,tn,en,ke,{})}}function an(t){let e;const n=t[2].default,a=ht(n,t,t[3],null);return{c(){a&&a.c()},l(i){a&&a.l(i)},m(i,r){a&&a.m(i,r),e=!0},p(i,r){a&&a.p&&(!e||r&8)&&_t(a,n,i,i[3],e?bt(n,i[3],r,null):pt(i[3]),null)},i(i){e||($(a,i),e=!0)},o(i){M(a,i),e=!1},d(i){a&&a.d(i)}}}function rn(t){let e,n;const a=[{name:"scaling"},t[1],{iconNode:t[0]}];let i={$$slots:{default:[an]},$$scope:{ctx:t}};for(let r=0;r<a.length;r+=1)i=Re(i,a[r]);return e=new Ct({props:i}),{c(){W(e.$$.fragment)},l(r){Y(e.$$.fragment,r)},m(r,l){G(e,r,l),n=!0},p(r,[l]){const o=l&3?Rt(a,[a[0],l&2&&Et(r[1]),l&1&&{iconNode:r[0]}]):{};l&8&&(o.$$scope={dirty:l,ctx:r}),e.$set(o)},i(r){n||($(e.$$.fragment,r),n=!0)},o(r){M(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function ln(t,e,n){let{$$slots:a={},$$scope:i}=e;const r=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}],["path",{d:"M14 15H9v-5"}],["path",{d:"M16 3h5v5"}],["path",{d:"M21 3 9 15"}]];return t.$$set=l=>{n(1,e=Re(Re({},e),$e(l))),"$$scope"in l&&n(3,i=l.$$scope)},e=$e(e),[r,e,a,i]}class on extends De{constructor(e){super(),Oe(this,e,ln,rn,ke,{})}}const sn=async({data:t})=>({...t}),ka=Object.freeze(Object.defineProperty({__proto__:null,load:sn},Symbol.toStringTag,{value:"Module"}));var cn=typeof global=="object"&&global&&global.Object===Object&&global,fn=typeof self=="object"&&self&&self.Object===Object&&self,It=cn||fn||Function("return this")(),Me=It.Symbol,Nt=Object.prototype,un=Nt.hasOwnProperty,dn=Nt.toString,Ne=Me?Me.toStringTag:void 0;function mn(t){var e=un.call(t,Ne),n=t[Ne];try{t[Ne]=void 0;var a=!0}catch{}var i=dn.call(t);return a&&(e?t[Ne]=n:delete t[Ne]),i}var gn=Object.prototype,hn=gn.toString;function _n(t){return hn.call(t)}var pn="[object Null]",bn="[object Undefined]",Je=Me?Me.toStringTag:void 0;function vn(t){return t==null?t===void 0?bn:pn:Je&&Je in Object(t)?mn(t):_n(t)}function wn(t){return t!=null&&typeof t=="object"}var yn="[object Symbol]";function Rn(t){return typeof t=="symbol"||wn(t)&&vn(t)==yn}var En=/\s/;function Cn(t){for(var e=t.length;e--&&En.test(t.charAt(e)););return e}var In=/^\s+/;function Nn(t){return t&&t.slice(0,Cn(t)+1).replace(In,"")}function Be(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var Qe=NaN,Sn=/^[-+]0x[0-9a-f]+$/i,kn=/^0b[01]+$/i,Dn=/^0o[0-7]+$/i,On=parseInt;function xe(t){if(typeof t=="number")return t;if(Rn(t))return Qe;if(Be(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Be(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Nn(t);var n=kn.test(t);return n||Dn.test(t)?On(t.slice(2),n?2:8):Sn.test(t)?Qe:+t}var Pe=function(){return It.Date.now()},An="Expected a function",Tn=Math.max,Un=Math.min;function St(t,e,n){var a,i,r,l,o,c,d=0,g=!1,m=!1,s=!0;if(typeof t!="function")throw new TypeError(An);e=xe(e)||0,Be(n)&&(g=!!n.leading,m="maxWait"in n,r=m?Tn(xe(n.maxWait)||0,e):r,s="trailing"in n?!!n.trailing:s);function h(S){var K=a,Q=i;return a=i=void 0,d=S,l=t.apply(Q,K),l}function p(S){return d=S,o=setTimeout(O,e),g?h(S):l}function C(S){var K=S-c,Q=S-d,re=e-K;return m?Un(re,r-Q):re}function L(S){var K=S-c,Q=S-d;return c===void 0||K>=e||K<0||m&&Q>=r}function O(){var S=Pe();if(L(S))return I(S);o=setTimeout(O,C(S))}function I(S){return o=void 0,s&&a?h(S):(a=i=void 0,l)}function k(){o!==void 0&&clearTimeout(o),d=0,a=c=i=o=void 0}function B(){return o===void 0?l:I(Pe())}function P(){var S=Pe(),K=L(S);if(a=arguments,i=this,c=S,K){if(o===void 0)return p(c);if(m)return clearTimeout(o),o=setTimeout(O,e),h(c)}return o===void 0&&(o=setTimeout(O,e)),l}return P.cancel=k,P.flush=B,P}function Ln(t){let e;return{c(){e=T("canvas"),this.h()},l(n){e=U(n,"CANVAS",{class:!0}),j(e).forEach(R),this.h()},h(){w(e,"class","id-canvas svelte-14cw9ao")},m(n,a){F(n,e,a),t[10](e)},p:fe,i:fe,o:fe,d(n){n&&R(e),t[10](null)}}}const $n=20,Mn=.5,et=2,Ue=1013,Le=638,tt=.2,nt=20,Fn=1e4;function je(t){if(!t)return;const e=t.getContext("2d");e&&e.clearRect(0,0,t.width,t.height),t.width=0,t.height=0}function at(t){const{style:e="normal",weight:n=400,size:a=16,family:i="Arial"}=t;return`${e} ${n} ${a}px "${i}"`}function Pn(t,e,n){let{elements:a}=e,{backgroundUrl:i}=e,{formData:r}=e,{fileUploads:l}=e,{imagePositions:o}=e,{fullResolution:c=!1}=e,{isDragging:d=!1}=e;const g=vt();class m extends Error{constructor(E,v){super(E);Ye(this,"code");this.code=v,this.name="CanvasOperationError"}}let s,h,p=null,C=null,L=null,O=!1,I=!1,k=!1,B=!1;const P=new Map,S=new Map;let K;function Q(){const u=Date.now(),_=5*60*1e3;for(const[E,v]of P)u-v.lastUsed>_&&(URL.revokeObjectURL(E),P.delete(E));for(const[E,v]of S)u-v.lastUsed>_&&(URL.revokeObjectURL(E),S.delete(E));for(;P.size>nt;){let E=null,v=1/0;for(const[f,b]of P)b.lastUsed<v&&(v=b.lastUsed,E=f);E&&(URL.revokeObjectURL(E),P.delete(E))}}function re(){if("memory"in performance){const u=performance.memory;u.usedJSHeapSize>u.jsHeapSizeLimit*.8&&(console.warn("High memory usage detected, cleaning caches..."),Q())}}async function ie(u,_=!1){if(!u)throw new m("Cannot load image: browser not available or URL is empty","IMAGE_LOAD_ERROR");const E=_?S:P,v=E.get(u);if(v!=null&&v.image)return v.lastUsed=Date.now(),v.image;E.size>=nt&&Q();try{const f=await ve(u);if(_){const b=await Ce(f);return E.set(u,{image:b,lastUsed:Date.now()}),b}return E.set(u,{image:f,lastUsed:Date.now()}),f}catch(f){const b=f instanceof Error?f.message:"Unknown error";throw new m(`Failed to load and cache image: ${b}`,"IMAGE_CACHE_ERROR")}}function de(){try{if(!s)throw new m("Display canvas is not initialized","DISPLAY_CANVAS_MISSING");if(!h)throw new m("Buffer canvas is not initialized","BUFFER_CANVAS_MISSING");if(!p)throw new m("Offscreen canvas is not initialized","OFFSCREEN_CANVAS_MISSING");if(!C||!L)throw new m("Canvas context is not initialized","CONTEXT_MISSING");if(!O)throw new m("Canvas is not ready for operations","CANVAS_NOT_READY");return{ready:!0}}catch(u){return u instanceof m?{ready:!1,error:{code:u.code,message:u.message}}:{ready:!1,error:{code:"UNKNOWN_ERROR",message:"An unexpected error occurred while checking canvas readiness"}}}}Ve(async()=>{B=!0,await be(),K=setInterval(re,Fn)}),wt(()=>{K&&clearInterval(K),je(s),je(h),Q()}),Ut(async()=>{!O&&B&&await be()});async function be(){if(!s){g("error",{code:"INITIALIZATION_ERROR",message:"Cannot initialize canvas: browser or canvas not available"});return}try{if(C=s.getContext("2d"),!C)throw new m("Failed to get display canvas context","DISPLAY_CONTEXT_ERROR");if(h=document.createElement("canvas"),L=h.getContext("2d"),!L)throw new m("Failed to get buffer canvas context","BUFFER_CONTEXT_ERROR");p=new OffscreenCanvas(Ue,Le),await new Promise(u=>requestAnimationFrame(u)),O=!0,await x(),g("ready",{isReady:!0})}catch(u){O=!1;const _=u instanceof m?{code:u.code,message:u.message}:{code:"INITIALIZATION_ERROR",message:"Failed to initialize canvas"};g("error",_)}}async function ve(u){if(!u)throw new m("Cannot load image: browser not available or URL is empty","IMAGE_LOAD_ERROR");return new Promise((_,E)=>{const v=new Image;v.crossOrigin="anonymous",v.onload=()=>_(v),v.onerror=()=>E(new m(`Failed to load image: ${u}`,"IMAGE_LOAD_ERROR")),v.src=u})}async function Ce(u){try{const _=document.createElement("canvas"),E=_.getContext("2d");if(!E)throw new m("Failed to get context for low-res image creation","LOWRES_CONTEXT_ERROR");const v=400;let f=u.width*tt,b=u.height*tt;if(f>v||b>v){const N=u.width/u.height;f>b?(f=v,b=f/N):(b=v,f=b*N)}return _.width=f,_.height=b,E.drawImage(u,0,0,f,b),new Promise((N,A)=>{_.toBlob(X=>{if(!X){A(new m("Failed to create blob for low-res image","BLOB_CREATION_ERROR"));return}const V=new Image;V.onload=()=>{je(_),N(V)},V.onerror=ae=>A(new m("Failed to load low-res image","LOWRES_LOAD_ERROR"));const Z=URL.createObjectURL(X);V.src=Z,V.onload=()=>{URL.revokeObjectURL(Z),N(V)}},"image/jpeg",.5)})}catch(_){return console.error("Error creating low-res image:",_),u}}function Ie(u,_={}){const E=u.font,v="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ";try{u.font=at(_);const f=u.measureText(v),b=f.actualBoundingBoxAscent+f.actualBoundingBoxDescent,N=f.fontBoundingBoxAscent||0,A=f.fontBoundingBoxDescent||0;return Math.max(b,N+A)}catch(f){return console.error("Error measuring text height:",f),0}finally{u.font=E}}const y=St(()=>{!k&&Fe&&(k=!0,requestAnimationFrame(x))},$n);async function x(){const u=de();if(!u.ready||I){u.error&&g("error",u.error);return}try{I=!0,k=!1;const _=c?1:Mn,E=Ue*_,v=Le*_;(h.width!==E||h.height!==v)&&(h.width=E,h.height=v),await J(L,_,!1),(s.width!==E||s.height!==v)&&(n(0,s.width=E,s),n(0,s.height=v,s)),C.drawImage(h,0,0),g("rendered"),re()}catch(_){const E=_ instanceof m?{code:_.code,message:_.message}:{code:"RENDER_ERROR",message:"Failed to render ID card"};g("error",E)}finally{I=!1,k&&Fe&&requestAnimationFrame(x)}}async function J(u,_,E){if(u.clearRect(0,0,u.canvas.width,u.canvas.height),i)try{const v=await ie(i);u.drawImage(v,0,0,u.canvas.width,u.canvas.height)}catch{g("error",{code:"BACKGROUND_LOAD_ERROR",message:"Error loading background image"})}for(const v of a)try{v.type==="text"||v.type==="selection"?ee(u,v,_):(v.type==="photo"||v.type==="signature")&&await se(u,v,_,E)}catch{g("error",{code:"ELEMENT_RENDER_ERROR",message:`Error rendering element ${v.variableName}`})}}function ee(u,_,E){var v;if(!(_.type!=="text"&&_.type!=="selection"))try{const f=E*et,b=(_.size||12)*f,N={family:_.font,size:b,weight:_.fontWeight,style:_.fontStyle};u.font=at(N),u.fillStyle=_.color||"black",u.textAlign=_.alignment,u.textBaseline="middle";let A="";_.type==="selection"?A=r[_.variableName]||((v=_.options)==null?void 0:v[0])||"":A=r[_.variableName]||"";const X=_.textTransform||"none";X==="uppercase"?A=A.toUpperCase():X==="lowercase"?A=A.toLowerCase():X==="capitalize"&&(A=A.split(" ").map(he=>he.charAt(0).toUpperCase()+he.slice(1).toLowerCase()).join(" "));const V=(_.width||0)*f,Z=(_.height||0)*f,ae=(_.x||0)*f,te=(_.y||0)*f;let me=ae;_.alignment==="center"?me+=V/2:_.alignment==="right"&&(me+=V);const ye=Ie(u,N),ge=te+Z/2;if(_.textDecoration==="underline"){const he=u.measureText(A),Ae=ge+ye/2;u.beginPath(),u.moveTo(me-(_.alignment==="right"?he.width:0),Ae),u.lineTo(me+(_.alignment==="left"?he.width:0),Ae),u.strokeStyle=_.color||"black",u.lineWidth=Math.max(1,b*.05),u.stroke()}typeof _.opacity=="number"&&(u.globalAlpha=_.opacity),u.fillText(A,me,ge),u.globalAlpha=1}catch{throw new m(`Failed to render text element: ${_.variableName}`,"TEXT_RENDER_ERROR")}}async function se(u,_,E,v){if(!(_.type!=="photo"&&_.type!=="signature"))try{const f=E*et,b=l[_.variableName],N=o[_.variableName],A=(_.x||0)*f,X=(_.y||0)*f,V=(_.width||100)*f,Z=(_.height||100)*f;if(u.save(),u.beginPath(),u.rect(A,X,V,Z),u.clip(),b)try{const ae=await ie(URL.createObjectURL(b),d&&!v&&_.type!=="signature"),te=ae.width/ae.height,me=V/Z;let ye=V*(N.scale||1),ge=Z*(N.scale||1);te>me?ge=ye/te:ye=ge*te;const he=A+(V-ye)/2+(N.x||0)*f,Ae=X+(Z-ge)/2+(N.y||0)*f;_.type==="signature"&&(u.globalCompositeOperation="multiply"),u.drawImage(ae,he,Ae,ye,ge),u.globalCompositeOperation="source-over"}catch(ae){throw v||ne(u,A,X,V,Z,"Error Photo",f),new m(`Failed to load image for ${_.variableName}: ${ae.message||"Unknown error"}`,"IMAGE_RENDER_ERROR")}else v||ne(u,A,X,V,Z,_.type,f);u.restore()}catch{throw new m(`Failed to render image element: ${_.variableName}`,"IMAGE_RENDER_ERROR")}}function ne(u,_,E,v,f,b,N){try{u.fillStyle="#f0f0f0",u.fillRect(_,E,v,f),u.strokeStyle="#999",u.strokeRect(_,E,v,f),u.fillStyle="#999",u.font=`${12*N}px Arial`,u.textAlign="center",u.textBaseline="middle",u.fillText(b,_+v/2,E+f/2)}catch{throw new m("Failed to render placeholder","PLACEHOLDER_RENDER_ERROR")}}async function le(){var _,E,v,f;const u=de();if(!u.ready)throw g("error",{code:((_=u.error)==null?void 0:_.code)||"CANVAS_NOT_READY",message:((E=u.error)==null?void 0:E.message)||"Canvas is not ready for rendering"}),new m(((v=u.error)==null?void 0:v.message)||"Canvas is not ready for rendering",((f=u.error)==null?void 0:f.code)||"CANVAS_NOT_READY");if(!p){const b={code:"OFFSCREEN_CANVAS_ERROR",message:"Offscreen canvas is not available for full resolution render"};throw g("error",b),new m(b.message,b.code)}try{const b=p.getContext("2d");if(!b)throw new m("Could not get 2D context from offscreen canvas","CONTEXT_ACQUISITION_ERROR");p.width=Ue,p.height=Le,b.clearRect(0,0,Ue,Le),await J(b,1,!0);const N=await p.convertToBlob({type:"image/png",quality:1});if(!N)throw new m("Failed to generate image blob","BLOB_GENERATION_ERROR");return N}catch(b){const N=b instanceof m?{code:b.code,message:b.message}:{code:"RENDER_ERROR",message:"Failed to render full resolution image"};throw g("error",N),new m(N.message,N.code)}}function we(u){Se[u?"unshift":"push"](()=>{s=u,n(0,s)})}return t.$$set=u=>{"elements"in u&&n(1,a=u.elements),"backgroundUrl"in u&&n(2,i=u.backgroundUrl),"formData"in u&&n(3,r=u.formData),"fileUploads"in u&&n(4,l=u.fileUploads),"imagePositions"in u&&n(5,o=u.imagePositions),"fullResolution"in u&&n(6,c=u.fullResolution),"isDragging"in u&&n(7,d=u.isDragging)},t.$$.update=()=>{t.$$.dirty[0]&250&&(a||r||l||o||c||d)&&y()},[s,a,i,r,l,o,c,d,de,le,we]}class kt extends De{constructor(e){super(),Oe(this,e,Pn,Ln,ke,{elements:1,backgroundUrl:2,formData:3,fileUploads:4,imagePositions:5,fullResolution:6,isDragging:7,isCanvasReady:8,renderFullResolution:9},null,[-1,-1])}get isCanvasReady(){return this.$$.ctx[8]}get renderFullResolution(){return this.$$.ctx[9]}}const jn=localStorage.getItem("darkMode")==="true",Dt=Gt(jn);Dt.subscribe(t=>{localStorage.setItem("darkMode",String(t)),t?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")});function Bn(t){let e,n,a,i,r,l,o,c,d,g,m,s,h;return o=new nn({props:{size:16}}),g=new on({props:{size:16}}),{c(){e=T("div"),n=T("div"),a=T("canvas"),i=H(),r=T("div"),l=T("div"),W(o.$$.fragment),c=H(),d=T("div"),W(g.$$.fragment),this.h()},l(p){e=U(p,"DIV",{class:!0});var C=j(e);n=U(C,"DIV",{class:!0,style:!0});var L=j(n);a=U(L,"CANVAS",{width:!0,height:!0,class:!0}),j(a).forEach(R),L.forEach(R),i=z(C),r=U(C,"DIV",{class:!0});var O=j(r);l=U(O,"DIV",{class:!0,role:!0,tabindex:!0,"aria-label":!0});var I=j(l);Y(o.$$.fragment,I),I.forEach(R),c=z(O),d=U(O,"DIV",{class:!0,role:!0,tabindex:!0,"aria-label":!0});var k=j(d);Y(g.$$.fragment,k),k.forEach(R),O.forEach(R),C.forEach(R),this.h()},h(){w(a,"width",t[2]),w(a,"height",t[1]),w(a,"class","cursor-pointer"),w(n,"class","relative"),Ge(n,"width",t[2]+"px"),Ge(n,"height",t[1]+"px"),w(l,"class","w-6 h-6 bg-gray-200 flex items-center justify-center cursor-move active:bg-gray-300"),w(l,"role","button"),w(l,"tabindex","0"),w(l,"aria-label","Move image"),w(d,"class","w-6 h-6 bg-gray-200 flex items-center justify-center cursor-se-resize active:bg-gray-300"),w(d,"role","button"),w(d,"tabindex","0"),w(d,"aria-label","Resize image"),w(r,"class","ml-2 flex flex-col gap-2"),w(e,"class","flex items-center touch-none")},m(p,C){F(p,e,C),D(e,n),D(n,a),t[12](a),D(e,i),D(e,r),D(r,l),G(o,l,null),D(r,c),D(r,d),G(g,d,null),m=!0,s||(h=[oe(a,"click",t[3]),oe(l,"mousedown",t[13]),oe(l,"touchstart",t[14]),oe(d,"mousedown",t[15]),oe(d,"touchstart",t[16])],s=!0)},p:fe,i(p){m||($(o.$$.fragment,p),$(g.$$.fragment,p),m=!0)},o(p){M(o.$$.fragment,p),M(g.$$.fragment,p),m=!1},d(p){p&&R(e),t[12](null),q(o),q(g),s=!1,He(h)}}}const Vn=100;function Hn(t,e,n){let{width:a}=e,{height:i}=e,{fileUrl:r=null}=e,{initialScale:l=1}=e,{initialX:o=0}=e,{initialY:c=0}=e,{isSignature:d=!1}=e;const g=vt();let m,s,h=l,p=o,C=c,L=!1;const O=a/i,I=Math.min(Vn,i),k=I*O,B=I/i;Ve(()=>{s=m.getContext("2d"),P()});function P(){s.fillStyle="#f0f0f0",s.fillRect(0,0,k,I),s.strokeStyle="#999",s.strokeRect(0,0,k,I),s.fillStyle="#999",s.font="14px Arial",s.textAlign="center",s.textBaseline="middle",s.fillText("Click to upload",k/2,I/2)}function S(y){const x=y.width/y.height;let J=a*h,ee=i*h;x>O?ee=J/x:J=ee*x,s.clearRect(0,0,k,I),s.save(),s.beginPath(),s.rect(0,0,k,I),s.clip(),d&&(s.fillStyle="white",s.fillRect(0,0,k,I)),s.drawImage(y,p*B+(k-J*B)/2,C*B+(I-ee*B)/2,J*B,ee*B),s.restore()}function K(){g("selectFile")}const Q=St((y,x,J)=>{g("update",{scale:y,x,y:J})},16);function re(){if(r){const y=new Image;y.onload=()=>S(y),y.src=r}}function ie(y,x){y.preventDefault(),L=!0;const J="touches"in y?{x:y.touches[0].clientX,y:y.touches[0].clientY}:{x:y.clientX,y:y.clientY},ee={scale:h,x:p,y:C};function se(le){if(!L)return;const we="touches"in le?{x:le.touches[0].clientX,y:le.touches[0].clientY}:{x:le.clientX,y:le.clientY},u=we.x-J.x,_=we.y-J.y;if(x==="resize"){const E=Math.max(u,_);h=Math.max(.1,ee.scale+E/(100*B))}else p=ee.x+u/B,C=ee.y+_/B;requestAnimationFrame(re),Q(h,p,C)}function ne(){L=!1,window.removeEventListener("mousemove",se),window.removeEventListener("mouseup",ne),window.removeEventListener("touchmove",se),window.removeEventListener("touchend",ne),window.removeEventListener("touchcancel",ne)}window.addEventListener("mousemove",se),window.addEventListener("mouseup",ne),window.addEventListener("touchmove",se),window.addEventListener("touchend",ne),window.addEventListener("touchcancel",ne)}function de(y){Se[y?"unshift":"push"](()=>{m=y,n(0,m)})}const be=y=>ie(y,"move"),ve=y=>ie(y,"move"),Ce=y=>ie(y,"resize"),Ie=y=>ie(y,"resize");return t.$$set=y=>{"width"in y&&n(5,a=y.width),"height"in y&&n(6,i=y.height),"fileUrl"in y&&n(7,r=y.fileUrl),"initialScale"in y&&n(8,l=y.initialScale),"initialX"in y&&n(9,o=y.initialX),"initialY"in y&&n(10,c=y.initialY),"isSignature"in y&&n(11,d=y.isSignature)},t.$$.update=()=>{if(t.$$.dirty&128&&r){const y=new Image;y.onload=()=>S(y),y.src=r}},[m,I,k,K,ie,a,i,r,l,o,c,d,de,be,ve,Ce,Ie]}class zn extends De{constructor(e){super(),Oe(this,e,Hn,Bn,ke,{width:5,height:6,fileUrl:7,initialScale:8,initialX:9,initialY:10,isSignature:11})}}function rt(t,e,n){const a=t.slice();return a[45]=e[n],a}function it(t,e,n){const a=t.slice();return a[48]=e[n],a[49]=e,a[50]=n,a}function lt(t,e,n){const a=t.slice();return a[51]=e[n],a}function Xn(t){let e,n,a,i={elements:t[14].template_elements.filter(sa),backgroundUrl:t[14].front_background,formData:t[4],fileUploads:t[5],imagePositions:t[6],fullResolution:Ot,isDragging:t[10]};return n=new kt({props:i}),t[25](n),n.$on("ready",t[26]),n.$on("error",t[27]),{c(){e=T("div"),W(n.$$.fragment),this.h()},l(r){e=U(r,"DIV",{class:!0});var l=j(e);Y(n.$$.fragment,l),l.forEach(R),this.h()},h(){w(e,"class","w-full aspect-[1013/638]")},m(r,l){F(r,e,l),G(n,e,null),a=!0},p(r,l){const o={};l[0]&16&&(o.formData=r[4]),l[0]&32&&(o.fileUploads=r[5]),l[0]&64&&(o.imagePositions=r[6]),l[0]&1024&&(o.isDragging=r[10]),n.$set(o)},i(r){a||($(n.$$.fragment,r),a=!0)},o(r){M(n.$$.fragment,r),a=!1},d(r){r&&R(e),t[25](null),q(n)}}}function Wn(t){let e,n,a={elements:t[14].template_elements.filter(ca),backgroundUrl:t[14].back_background,formData:t[4],fileUploads:t[5],imagePositions:t[6],fullResolution:Ot,isDragging:t[10]};return e=new kt({props:a}),t[28](e),e.$on("ready",t[29]),e.$on("error",t[30]),{c(){W(e.$$.fragment)},l(i){Y(e.$$.fragment,i)},m(i,r){G(e,i,r),n=!0},p(i,r){const l={};r[0]&16&&(l.formData=i[4]),r[0]&32&&(l.fileUploads=i[5]),r[0]&64&&(l.imagePositions=i[6]),r[0]&1024&&(l.isDragging=i[10]),e.$set(l)},i(i){n||($(e.$$.fragment,i),n=!0)},o(i){M(e.$$.fragment,i),n=!1},d(i){t[28](null),q(e,i)}}}function Yn(t){let e,n,a="ID Card Preview",i,r,l,o,c="Front",d,g,m,s,h="Back",p,C,L=t[14]&&Xn(t),O=t[14]&&Wn(t);return{c(){e=T("div"),n=T("h2"),n.textContent=a,i=H(),r=T("div"),l=T("div"),o=T("h3"),o.textContent=c,d=H(),L&&L.c(),g=H(),m=T("div"),s=T("h3"),s.textContent=h,p=H(),O&&O.c(),this.h()},l(I){e=U(I,"DIV",{class:!0});var k=j(e);n=U(k,"H2",{class:!0,"data-svelte-h":!0}),ue(n)!=="svelte-5zsvjx"&&(n.textContent=a),i=z(k),r=U(k,"DIV",{class:!0});var B=j(r);l=U(B,"DIV",{class:!0});var P=j(l);o=U(P,"H3",{class:!0,"data-svelte-h":!0}),ue(o)!=="svelte-5fkg9y"&&(o.textContent=c),d=z(P),L&&L.l(P),P.forEach(R),g=z(B),m=U(B,"DIV",{class:!0});var S=j(m);s=U(S,"H3",{class:!0,"data-svelte-h":!0}),ue(s)!=="svelte-iu2gxi"&&(s.textContent=h),p=z(S),O&&O.l(S),S.forEach(R),B.forEach(R),k.forEach(R),this.h()},h(){var I,k;w(n,"class","text-2xl font-bold mb-4"),w(o,"class","text-lg font-semibold mb-2"),w(l,"class","front-canvas"),w(s,"class","text-lg font-semibold mb-2"),w(m,"class","back-canvas"),w(r,"class","canvas-wrapper svelte-1mja2ju"),qe(r,"landscape",((I=t[14])==null?void 0:I.orientation)==="landscape"),qe(r,"portrait",((k=t[14])==null?void 0:k.orientation)==="portrait"),w(e,"class","p-4")},m(I,k){F(I,e,k),D(e,n),D(e,i),D(e,r),D(r,l),D(l,o),D(l,d),L&&L.m(l,null),D(r,g),D(r,m),D(m,s),D(m,p),O&&O.m(m,null),C=!0},p(I,k){I[14]&&L.p(I,k),I[14]&&O.p(I,k)},i(I){C||($(L),$(O),C=!0)},o(I){M(L),M(O),C=!1},d(I){I&&R(e),L&&L.d(),O&&O.d()}}}function Gn(t){let e,n=[],a=new Map,i,r,l,o,c,d,g=Ee(t[14].template_elements);const m=h=>h[48].variableName;for(let h=0;h<g.length;h+=1){let p=it(t,g,h),C=m(p);a.set(C,n[h]=ft(C,p))}r=new Zt({props:{type:"submit",class:"w-full mt-6",disabled:t[0],$$slots:{default:[ia]},$$scope:{ctx:t}}});let s=t[1]&&dt(t);return{c(){e=T("form");for(let h=0;h<n.length;h+=1)n[h].c();i=H(),W(r.$$.fragment),l=H(),s&&s.c(),this.h()},l(h){e=U(h,"FORM",{action:!0,method:!0,enctype:!0});var p=j(e);for(let C=0;C<n.length;C+=1)n[C].l(p);i=z(p),Y(r.$$.fragment,p),l=z(p),s&&s.l(p),p.forEach(R),this.h()},h(){w(e,"action","?/saveIdCard"),w(e,"method","POST"),w(e,"enctype","multipart/form-data")},m(h,p){F(h,e,p);for(let C=0;C<n.length;C+=1)n[C]&&n[C].m(e,null);D(e,i),G(r,e,null),D(e,l),s&&s.m(e,null),t[35](e),o=!0,c||(d=[oe(e,"submit",Lt(t[17])),$t(Kt.call(null,e))],c=!0)},p(h,p){p[0]&1923280&&(g=Ee(h[14].template_elements),Xe(),n=Mt(n,p,m,1,h,g,a,e,Ft,ft,i,it),We());const C={};p[0]&1&&(C.disabled=h[0]),p[0]&1|p[1]&8388608&&(C.$$scope={dirty:p,ctx:h}),r.$set(C),h[1]?s?s.p(h,p):(s=dt(h),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},i(h){if(!o){for(let p=0;p<g.length;p+=1)$(n[p]);$(r.$$.fragment,h),o=!0}},o(h){for(let p=0;p<n.length;p+=1)M(n[p]);M(r.$$.fragment,h),o=!1},d(h){h&&R(e);for(let p=0;p<n.length;p+=1)n[p].d();q(r),s&&s.d(),t[35](null),c=!1,He(d)}}}function qn(t){let e,n,a,i,r,l,o,c;n=new Vt({props:{for:t[48].variableName,class:"text-right",$$slots:{default:[Zn]},$$scope:{ctx:t}}});const d=[xn,Qn,Jn],g=[];function m(s,h){return s[48].type==="text"?0:s[48].type==="selection"&&s[48].options?1:s[48].type==="photo"||s[48].type==="signature"?2:-1}return~(i=m(t))&&(r=g[i]=d[i](t)),{c(){e=T("div"),W(n.$$.fragment),a=H(),r&&r.c(),this.h()},l(s){e=U(s,"DIV",{role:!0,tabindex:!0,class:!0});var h=j(e);Y(n.$$.fragment,h),a=z(h),r&&r.l(h),h.forEach(R),this.h()},h(){w(e,"role","button"),w(e,"tabindex","-1"),w(e,"class","grid grid-cols-[auto,1fr] gap-4 items-center")},m(s,h){F(s,e,h),G(n,e,null),D(e,a),~i&&g[i].m(e,null),l=!0,o||(c=[oe(e,"mousedown",t[18]),oe(e,"mouseup",t[19])],o=!0)},p(s,h){const p={};h[1]&8388608&&(p.$$scope={dirty:h,ctx:s}),n.$set(p),r&&r.p(s,h)},i(s){l||($(n.$$.fragment,s),$(r),l=!0)},o(s){M(n.$$.fragment,s),M(r),l=!1},d(s){s&&R(e),q(n),~i&&g[i].d(),o=!1,He(c)}}}function Kn(t){let e,n="*";return{c(){e=T("span"),e.textContent=n,this.h()},l(a){e=U(a,"SPAN",{class:!0,"data-svelte-h":!0}),ue(e)!=="svelte-1n3raya"&&(e.textContent=n),this.h()},h(){w(e,"class","text-red-500")},m(a,i){F(a,e,i)},d(a){a&&R(e)}}}function Zn(t){let e=t[48].variableName+"",n,a,i,r=(t[48].type==="text"||t[48].type==="selection")&&Kn();return{c(){n=_e(e),a=H(),r&&r.c(),i=ce()},l(l){n=pe(l,e),a=z(l),r&&r.l(l),i=ce()},m(l,o){F(l,n,o),F(l,a,o),r&&r.m(l,o),F(l,i,o)},p:fe,d(l){l&&(R(n),R(a),R(i)),r&&r.d(l)}}}function Jn(t){var r,l,o;let e,n;function a(){return t[33](t[48])}function i(...c){return t[34](t[48],...c)}return e=new zn({props:{width:t[48].width,height:t[48].height,fileUrl:t[12][t[48].variableName],initialScale:((r=t[6][t[48].variableName])==null?void 0:r.scale)??1,initialX:((l=t[6][t[48].variableName])==null?void 0:l.x)??0,initialY:((o=t[6][t[48].variableName])==null?void 0:o.y)??0,isSignature:t[48].type==="signature"}}),e.$on("selectFile",a),e.$on("update",i),{c(){W(e.$$.fragment)},l(c){Y(e.$$.fragment,c)},m(c,d){G(e,c,d),n=!0},p(c,d){var m,s,h;t=c;const g={};d[0]&4096&&(g.fileUrl=t[12][t[48].variableName]),d[0]&64&&(g.initialScale=((m=t[6][t[48].variableName])==null?void 0:m.scale)??1),d[0]&64&&(g.initialX=((s=t[6][t[48].variableName])==null?void 0:s.x)??0),d[0]&64&&(g.initialY=((h=t[6][t[48].variableName])==null?void 0:h.y)??0),e.$set(g)},i(c){n||($(e.$$.fragment,c),n=!0)},o(c){M(e.$$.fragment,c),n=!1},d(c){q(e,c)}}}function Qn(t){let e,n,a,i;function r(...o){return t[32](t[48],...o)}n=new Ht({props:{selected:t[7][t[48].variableName],onSelectedChange:r,$$slots:{default:[ra]},$$scope:{ctx:t}}});let l=t[11][t[48].variableName]&&st();return{c(){e=T("div"),W(n.$$.fragment),a=H(),l&&l.c(),this.h()},l(o){e=U(o,"DIV",{class:!0});var c=j(e);Y(n.$$.fragment,c),a=z(c),l&&l.l(c),c.forEach(R),this.h()},h(){w(e,"class","relative w-full")},m(o,c){F(o,e,c),G(n,e,null),D(e,a),l&&l.m(e,null),i=!0},p(o,c){t=o;const d={};c[0]&128&&(d.selected=t[7][t[48].variableName]),c[0]&2192&&(d.onSelectedChange=r),c[0]&2176|c[1]&8388608&&(d.$$scope={dirty:c,ctx:t}),n.$set(d),t[11][t[48].variableName]?l||(l=st(),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},i(o){i||($(n.$$.fragment,o),i=!0)},o(o){M(n.$$.fragment,o),i=!1},d(o){o&&R(e),q(n),l&&l.d()}}}function xn(t){let e,n,a,i,r,l;function o(){t[31].call(n,t[48])}let c=t[11][t[48].variableName]&&ct();return{c(){e=T("div"),n=T("input"),i=H(),c&&c.c(),this.h()},l(d){e=U(d,"DIV",{class:!0});var g=j(e);n=U(g,"INPUT",{type:!0,id:!0,name:!0,class:!0,placeholder:!0}),i=z(g),c&&c.l(g),g.forEach(R),this.h()},h(){w(n,"type","text"),w(n,"id",t[48].variableName),w(n,"name",t[48].variableName),w(n,"class",a="w-full px-3 py-2 border rounded-md "+(t[11][t[48].variableName]?"border-red-500 ring-1 ring-red-500":"border-gray-300")),w(n,"placeholder",`Enter ${t[48].variableName}`),w(e,"class","w-full")},m(d,g){F(d,e,g),D(e,n),Ke(n,t[4][t[48].variableName]),D(e,i),c&&c.m(e,null),r||(l=oe(n,"input",o),r=!0)},p(d,g){t=d,g[0]&2048&&a!==(a="w-full px-3 py-2 border rounded-md "+(t[11][t[48].variableName]?"border-red-500 ring-1 ring-red-500":"border-gray-300"))&&w(n,"class",a),g[0]&16400&&n.value!==t[4][t[48].variableName]&&Ke(n,t[4][t[48].variableName]),t[11][t[48].variableName]?c||(c=ct(),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},i:fe,o:fe,d(d){d&&R(e),c&&c.d(),r=!1,l()}}}function ea(t){var a;let e=(((a=t[7][t[48].variableName])==null?void 0:a.label)||"Select an option")+"",n;return{c(){n=_e(e)},l(i){n=pe(i,e)},m(i,r){F(i,n,r)},p(i,r){var l;r[0]&128&&e!==(e=(((l=i[7][i[48].variableName])==null?void 0:l.label)||"Select an option")+"")&&ze(n,e)},d(i){i&&R(n)}}}function ta(t){let e,n;return e=new Wt({props:{placeholder:"Select an option",$$slots:{default:[ea]},$$scope:{ctx:t}}}),{c(){W(e.$$.fragment)},l(a){Y(e.$$.fragment,a)},m(a,i){G(e,a,i),n=!0},p(a,i){const r={};i[0]&128|i[1]&8388608&&(r.$$scope={dirty:i,ctx:a}),e.$set(r)},i(a){n||($(e.$$.fragment,a),n=!0)},o(a){M(e.$$.fragment,a),n=!1},d(a){q(e,a)}}}function na(t){let e=t[51]+"",n,a;return{c(){n=_e(e),a=H()},l(i){n=pe(i,e),a=z(i)},m(i,r){F(i,n,r),F(i,a,r)},p:fe,d(i){i&&(R(n),R(a))}}}function ot(t){let e,n;return e=new Yt({props:{value:t[51],label:t[51],$$slots:{default:[na]},$$scope:{ctx:t}}}),{c(){W(e.$$.fragment)},l(a){Y(e.$$.fragment,a)},m(a,i){G(e,a,i),n=!0},p(a,i){const r={};i[1]&8388608&&(r.$$scope={dirty:i,ctx:a}),e.$set(r)},i(a){n||($(e.$$.fragment,a),n=!0)},o(a){M(e.$$.fragment,a),n=!1},d(a){q(e,a)}}}function aa(t){let e,n,a=Ee(t[48].options),i=[];for(let l=0;l<a.length;l+=1)i[l]=ot(lt(t,a,l));const r=l=>M(i[l],1,1,()=>{i[l]=null});return{c(){for(let l=0;l<i.length;l+=1)i[l].c();e=ce()},l(l){for(let o=0;o<i.length;o+=1)i[o].l(l);e=ce()},m(l,o){for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(l,o);F(l,e,o),n=!0},p(l,o){if(o[0]&16384){a=Ee(l[48].options);let c;for(c=0;c<a.length;c+=1){const d=lt(l,a,c);i[c]?(i[c].p(d,o),$(i[c],1)):(i[c]=ot(d),i[c].c(),$(i[c],1),i[c].m(e.parentNode,e))}for(Xe(),c=a.length;c<i.length;c+=1)r(c);We()}},i(l){if(!n){for(let o=0;o<a.length;o+=1)$(i[o]);n=!0}},o(l){i=i.filter(Boolean);for(let o=0;o<i.length;o+=1)M(i[o]);n=!1},d(l){l&&R(e),yt(i,l)}}}function ra(t){let e,n,a,i;return e=new zt({props:{class:"w-full "+(t[11][t[48].variableName]?"border-red-500 ring-1 ring-red-500":""),$$slots:{default:[ta]},$$scope:{ctx:t}}}),a=new Xt({props:{$$slots:{default:[aa]},$$scope:{ctx:t}}}),{c(){W(e.$$.fragment),n=H(),W(a.$$.fragment)},l(r){Y(e.$$.fragment,r),n=z(r),Y(a.$$.fragment,r)},m(r,l){G(e,r,l),F(r,n,l),G(a,r,l),i=!0},p(r,l){const o={};l[0]&2048&&(o.class="w-full "+(r[11][r[48].variableName]?"border-red-500 ring-1 ring-red-500":"")),l[0]&128|l[1]&8388608&&(o.$$scope={dirty:l,ctx:r}),e.$set(o);const c={};l[1]&8388608&&(c.$$scope={dirty:l,ctx:r}),a.$set(c)},i(r){i||($(e.$$.fragment,r),$(a.$$.fragment,r),i=!0)},o(r){M(e.$$.fragment,r),M(a.$$.fragment,r),i=!1},d(r){r&&R(n),q(e,r),q(a,r)}}}function st(t){let e,n="Please select an option";return{c(){e=T("p"),e.textContent=n,this.h()},l(a){e=U(a,"P",{class:!0,"data-svelte-h":!0}),ue(e)!=="svelte-1hudd6f"&&(e.textContent=n),this.h()},h(){w(e,"class","mt-1 text-sm text-red-500")},m(a,i){F(a,e,i)},d(a){a&&R(e)}}}function ct(t){let e,n="This field is required";return{c(){e=T("p"),e.textContent=n,this.h()},l(a){e=U(a,"P",{class:!0,"data-svelte-h":!0}),ue(e)!=="svelte-1nolave"&&(e.textContent=n),this.h()},h(){w(e,"class","mt-1 text-sm text-red-500")},m(a,i){F(a,e,i)},d(a){a&&R(e)}}}function ft(t,e){let n,a,i,r=e[48].variableName&&qn(e);return{key:t,first:null,c(){n=ce(),r&&r.c(),a=ce(),this.h()},l(l){n=ce(),r&&r.l(l),a=ce(),this.h()},h(){this.first=n},m(l,o){F(l,n,o),r&&r.m(l,o),F(l,a,o),i=!0},p(l,o){e=l,e[48].variableName&&r.p(e,o)},i(l){i||($(r),i=!0)},o(l){M(r),i=!1},d(l){l&&(R(n),R(a)),r&&r.d(l)}}}function ut(t){let e,n;return e=new Jt({props:{class:"mr-2 h-4 w-4 animate-spin"}}),{c(){W(e.$$.fragment)},l(a){Y(e.$$.fragment,a)},m(a,i){G(e,a,i),n=!0},i(a){n||($(e.$$.fragment,a),n=!0)},o(a){M(e.$$.fragment,a),n=!1},d(a){q(e,a)}}}function ia(t){let e,n,a=t[0]&&ut();return{c(){a&&a.c(),e=_e(`
                            Generate and Save ID Card`)},l(i){a&&a.l(i),e=pe(i,`
                            Generate and Save ID Card`)},m(i,r){a&&a.m(i,r),F(i,e,r),n=!0},p(i,r){i[0]?a?r[0]&1&&$(a,1):(a=ut(),a.c(),$(a,1),a.m(e.parentNode,e)):a&&(Xe(),M(a,1,1,()=>{a=null}),We())},i(i){n||($(a),n=!0)},o(i){M(a),n=!1},d(i){i&&R(e),a&&a.d(i)}}}function dt(t){let e,n;return{c(){e=T("p"),n=_e(t[1]),this.h()},l(a){e=U(a,"P",{class:!0});var i=j(e);n=pe(i,t[1]),i.forEach(R),this.h()},h(){w(e,"class","mt-2 text-sm text-red-500")},m(a,i){F(a,e,i),D(e,n)},p(a,i){i[0]&2&&ze(n,a[1])},d(a){a&&R(e)}}}function mt(t){let e,n,a,i,r,l,o,c=Ee(t[3]),d=[];for(let g=0;g<c.length;g+=1)d[g]=gt(rt(t,c,g));return{c(){e=T("div"),n=T("h3"),a=_e("Debug Messages:"),r=H(),l=T("div");for(let g=0;g<d.length;g+=1)d[g].c();this.h()},l(g){e=U(g,"DIV",{class:!0});var m=j(e);n=U(m,"H3",{class:!0});var s=j(n);a=pe(s,"Debug Messages:"),s.forEach(R),r=z(m),l=U(m,"DIV",{class:!0});var h=j(l);for(let p=0;p<d.length;p+=1)d[p].l(h);h.forEach(R),m.forEach(R),this.h()},h(){w(n,"class",i="font-bold mb-2 "+(t[13]?"text-gray-100":"text-gray-800")),w(l,"class","space-y-1"),w(e,"class",o="mt-6 p-4 rounded-lg "+(t[13]?"bg-gray-800 text-gray-100":"bg-gray-100 text-gray-800")+" border "+(t[13]?"border-gray-700":"border-gray-300"))},m(g,m){F(g,e,m),D(e,n),D(n,a),D(e,r),D(e,l);for(let s=0;s<d.length;s+=1)d[s]&&d[s].m(l,null)},p(g,m){if(m[0]&8192&&i!==(i="font-bold mb-2 "+(g[13]?"text-gray-100":"text-gray-800"))&&w(n,"class",i),m[0]&8200){c=Ee(g[3]);let s;for(s=0;s<c.length;s+=1){const h=rt(g,c,s);d[s]?d[s].p(h,m):(d[s]=gt(h),d[s].c(),d[s].m(l,null))}for(;s<d.length;s+=1)d[s].d(1);d.length=c.length}m[0]&8192&&o!==(o="mt-6 p-4 rounded-lg "+(g[13]?"bg-gray-800 text-gray-100":"bg-gray-100 text-gray-800")+" border "+(g[13]?"border-gray-700":"border-gray-300"))&&w(e,"class",o)},d(g){g&&R(e),yt(d,g)}}}function gt(t){let e,n=t[45]+"",a,i;return{c(){e=T("div"),a=_e(n),this.h()},l(r){e=U(r,"DIV",{class:!0});var l=j(e);a=pe(l,n),l.forEach(R),this.h()},h(){w(e,"class",i="py-1 "+(t[13]?"text-gray-300":"text-gray-700"))},m(r,l){F(r,e,l),D(e,a)},p(r,l){l[0]&8&&n!==(n=r[45]+"")&&ze(a,n),l[0]&8192&&i!==(i="py-1 "+(r[13]?"text-gray-300":"text-gray-700"))&&w(e,"class",i)},d(r){r&&R(e)}}}function la(t){let e,n,a='<h2 class="text-2xl font-bold">ID Card Form</h2>',i,r,l="Please fill out these details for your ID card.",o,c,d,g=t[14]&&t[14].template_elements&&Gn(t),m=t[3].length>0&&mt(t);return{c(){e=T("div"),n=T("div"),n.innerHTML=a,i=H(),r=T("p"),r.textContent=l,o=H(),g&&g.c(),c=H(),m&&m.c(),this.h()},l(s){e=U(s,"DIV",{class:!0});var h=j(e);n=U(h,"DIV",{class:!0,"data-svelte-h":!0}),ue(n)!=="svelte-147ibdb"&&(n.innerHTML=a),i=z(h),r=U(h,"P",{class:!0,"data-svelte-h":!0}),ue(r)!=="svelte-ygmfwx"&&(r.textContent=l),o=z(h),g&&g.l(h),c=z(h),m&&m.l(h),h.forEach(R),this.h()},h(){w(n,"class","flex justify-between items-center mb-4"),w(r,"class","text-muted-foreground mb-6"),w(e,"class","p-6")},m(s,h){F(s,e,h),D(e,n),D(e,i),D(e,r),D(e,o),g&&g.m(e,null),D(e,c),m&&m.m(e,null),d=!0},p(s,h){s[14]&&s[14].template_elements&&g.p(s,h),s[3].length>0?m?m.p(s,h):(m=mt(s),m.c(),m.m(e,null)):m&&(m.d(1),m=null)},i(s){d||($(g),d=!0)},o(s){M(g),d=!1},d(s){s&&R(e),g&&g.d(),m&&m.d()}}}function oa(t){let e,n,a,i,r,l,o;return a=new Ze({props:{class:"h-full",$$slots:{default:[Yn]},$$scope:{ctx:t}}}),l=new Ze({props:{class:"h-full",$$slots:{default:[la]},$$scope:{ctx:t}}}),{c(){e=T("div"),n=T("div"),W(a.$$.fragment),i=H(),r=T("div"),W(l.$$.fragment),this.h()},l(c){e=U(c,"DIV",{class:!0});var d=j(e);n=U(d,"DIV",{class:!0});var g=j(n);Y(a.$$.fragment,g),g.forEach(R),i=z(d),r=U(d,"DIV",{class:!0});var m=j(r);Y(l.$$.fragment,m),m.forEach(R),d.forEach(R),this.h()},h(){w(n,"class","w-full md:w-1/2"),w(r,"class","w-full md:w-1/2"),w(e,"class","container mx-auto p-4 flex flex-col md:flex-row gap-4")},m(c,d){F(c,e,d),D(e,n),G(a,n,null),D(e,i),D(e,r),G(l,r,null),o=!0},p(c,d){const g={};d[0]&1904|d[1]&8388608&&(g.$$scope={dirty:d,ctx:c}),a.$set(g);const m={};d[0]&14559|d[1]&8388608&&(m.$$scope={dirty:d,ctx:c}),l.$set(m)},i(c){o||($(a.$$.fragment,c),$(l.$$.fragment,c),o=!0)},o(c){M(a.$$.fragment,c),M(l.$$.fragment,c),o=!1},d(c){c&&R(e),q(a),q(l)}}}let Ot=!1;const sa=t=>t.side==="front",ca=t=>t.side==="back";function fa(t,e,n){let a,i,r,l;Te(t,Pt,f=>n(38,a=f)),Te(t,jt,f=>n(23,i=f)),Te(t,Bt,f=>n(24,r=f)),Te(t,Dt,f=>n(13,l=f));let{data:o}=e,c=a.params.id,d={...o.template,template_elements:o.template.template_elements.map(f=>({...f,width:f.width??100,height:f.height??100}))},g=!1,m=null,s,h=[],p={},C={},L={},O={},I,k,B=!1,P={},S={};function K(){d!=null&&d.template_elements&&d.template_elements.forEach(f=>{f.variableName&&(f.type==="text"||f.type==="selection"?(n(4,p[f.variableName]=f.content||"",p),f.type==="selection"&&n(7,O[f.variableName]={value:p[f.variableName],label:p[f.variableName]||"Select an option"},O)):(f.type==="photo"||f.type==="signature")&&(n(5,C[f.variableName]=null,C),n(6,L[f.variableName]={x:0,y:0,width:f.width||100,height:f.height||100,scale:1},L)))})}Ve(async()=>{var f;if(!c){n(1,m="No template ID provided");return}console.log(" [Use Template] Initializing with template:",{id:d.id,name:d.name,elementsCount:((f=d.template_elements)==null?void 0:f.length)||0}),K()});function Q(f){}function re(f,b){const{scale:N,x:A,y:X}=f.detail;n(6,L[b]={...L[b],scale:N,x:A,y:X},L)}async function ie(f){var b,N;f.preventDefault();try{if(!Ie()){n(1,m="Please fill in all required fields");return}if(n(0,g=!0),n(1,m=null),!d||!I||!k){n(1,m="Missing required components");return}const[A,X]=await Promise.all([I.renderFullResolution(),k.renderFullResolution()]),V=f.target,Z=new FormData(V);Z.append("templateId",a.params.id),Z.append("frontImage",A,"front.png"),Z.append("backImage",X,"back.png");const ae=await fetch("?/saveIdCard",{method:"POST",body:Z}),te=await ae.json();console.log("Save response:",te),ae.ok&&(te.type==="success"||te.data&&((b=te.data[0])!=null&&b.success))?qt("/id-gen/all-ids"):(n(1,m=te.data&&((N=te.data[0])==null?void 0:N.error)||"Failed to save ID card"),console.error("Save error:",m))}catch(A){console.error("Submit error:",A),n(1,m=A instanceof Error?A.message:"An unexpected error occurred")}finally{n(0,g=!1)}}function de(){n(10,B=!0)}function be(){n(10,B=!1)}function ve(f){const b=document.createElement("input");b.type="file",b.accept="image/*",b.onchange=N=>Ce(N,f),b.click()}function Ce(f,b){var V;const N=f.target;if(!((V=N.files)!=null&&V.length))return;const A=N.files[0];n(5,C[b]=A,C),S[b]&&URL.revokeObjectURL(S[b]);const X=URL.createObjectURL(A);n(12,S[b]=X,S)}function Ie(){n(11,P={});let f=!0,b=[];return d?(d.template_elements.forEach(N=>{var A;N.variableName&&(N.type==="text"||N.type==="selection")&&((A=p[N.variableName])!=null&&A.trim()||(n(11,P[N.variableName]=!0,P),b.push(N.variableName),f=!1))}),f||y(`Please fill in the following fields: ${b.join(", ")}`),f):!1}function y(f){n(3,h=[...h,f])}wt(()=>{Object.values(S).forEach(URL.revokeObjectURL)});function x(f){Se[f?"unshift":"push"](()=>{I=f,n(8,I)})}const J=()=>void 0,ee=({detail:f})=>y(`Front Canvas Error: ${f.code} - ${f.message}`);function se(f){Se[f?"unshift":"push"](()=>{k=f,n(9,k)})}const ne=()=>void 0,le=({detail:f})=>y(`Back Canvas Error: ${f.code} - ${f.message}`);function we(f){p[f.variableName]=this.value,n(4,p)}const u=(f,b)=>{b&&typeof b.value=="string"&&(n(4,p[f.variableName]=b.value,p),n(7,O[f.variableName]={value:b.value,label:b.value},O),P[f.variableName]&&n(11,P[f.variableName]=!1,P))},_=f=>ve(f.variableName),E=(f,b)=>re(b,f.variableName);function v(f){Se[f?"unshift":"push"](()=>{s=f,n(2,s)})}return t.$$set=f=>{"data"in f&&n(22,o=f.data)},t.$$.update=()=>{t.$$.dirty[0]&25165824&&(console.log("Use Template Page: Session exists:",!!r),console.log("Use Template Page: User exists:",!!i))},[g,m,s,h,p,C,L,O,I,k,B,P,S,l,d,Q,re,ie,de,be,ve,y,o,i,r,x,J,ee,se,ne,le,we,u,_,E,v]}class Da extends De{constructor(e){super(),Oe(this,e,fa,oa,ke,{data:22},null,[-1,-1])}}export{Da as component,ka as universal};
