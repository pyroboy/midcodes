var Yt=Object.defineProperty;var zt=(n,r,i)=>r in n?Yt(n,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[r]=i;var it=(n,r,i)=>zt(n,typeof r!="symbol"?r+"":r,i);import{d as Be,w as z,a as xe}from"./index.C9tjxovB.js";import{p as de,n as st}from"./stores.COJDcE9o.js";import{I as Ce,P as Se,a7 as pe}from"./scheduler.O3yElrGi.js";import{U as gt,N as Gt,P as Wt,d as Jt,e as bt,f as at,H as Zt,h as Xt,c as De,i as Kt,g as Qt}from"./entry.CPepBop_.js";import{e as en,d as ot}from"./forms.DqzkT_8L.js";class Ne extends Error{constructor(r,i){super(r),this.name="DevalueError",this.path=i.join("")}}function ut(n){return Object(n)!==n}const tn=Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function nn(n){const r=Object.getPrototypeOf(n);return r===Object.prototype||r===null||Object.getOwnPropertyNames(r).sort().join("\0")===tn}function rn(n){return Object.prototype.toString.call(n).slice(8,-1)}function sn(n){switch(n){case'"':return'\\"';case"<":return"\\u003C";case"\\":return"\\\\";case`
`:return"\\n";case"\r":return"\\r";case"	":return"\\t";case"\b":return"\\b";case"\f":return"\\f";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return n<" "?`\\u${n.charCodeAt(0).toString(16).padStart(4,"0")}`:""}}function fe(n){let r="",i=0;const e=n.length;for(let f=0;f<e;f+=1){const u=n[f],a=sn(u);a&&(r+=n.slice(i,f)+a,i=f+1)}return`"${i===0?n:r+n.slice(i)}"`}function an(n){return Object.getOwnPropertySymbols(n).filter(r=>Object.getOwnPropertyDescriptor(n,r).enumerable)}const on=/^[a-zA-Z_$][a-zA-Z_$0-9]*$/;function ft(n){return on.test(n)?"."+n:"["+JSON.stringify(n)+"]"}function un(n,r){const i=[],e=new Map,f=[];if(r)for(const c of Object.getOwnPropertyNames(r))f.push({key:c,fn:r[c]});const u=[];let a=0;function p(c){if(typeof c=="function")throw new Ne("Cannot stringify a function",u);if(e.has(c))return e.get(c);if(c===void 0)return gt;if(Number.isNaN(c))return Gt;if(c===1/0)return Wt;if(c===-1/0)return Jt;if(c===0&&1/c<0)return bt;const A=a++;e.set(c,A);for(const{key:R,fn:B}of f){const C=B(c);if(C)return i[A]=`["${R}",${p(C)}]`,A}let m="";if(ut(c))m=Re(c);else{const R=rn(c);switch(R){case"Number":case"String":case"Boolean":m=`["Object",${Re(c)}]`;break;case"BigInt":m=`["BigInt",${c}]`;break;case"Date":m=`["Date","${!isNaN(c.getDate())?c.toISOString():""}"]`;break;case"RegExp":const{source:C,flags:ee}=c;m=ee?`["RegExp",${fe(C)},"${ee}"]`:`["RegExp",${fe(C)}]`;break;case"Array":m="[";for(let b=0;b<c.length;b+=1)b>0&&(m+=","),b in c?(u.push(`[${b}]`),m+=p(c[b]),u.pop()):m+=Zt;m+="]";break;case"Set":m='["Set"';for(const b of c)m+=`,${p(b)}`;m+="]";break;case"Map":m='["Map"';for(const[b,P]of c)u.push(`.get(${ut(b)?Re(b):"..."})`),m+=`,${p(b)},${p(P)}`,u.pop();m+="]";break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":{const P=at(c.buffer);m='["'+R+'","'+P+'"]';break}case"ArrayBuffer":{m=`["ArrayBuffer","${at(c)}"]`;break}default:if(!nn(c))throw new Ne("Cannot stringify arbitrary non-POJOs",u);if(an(c).length>0)throw new Ne("Cannot stringify POJOs with symbolic keys",u);if(Object.getPrototypeOf(c)===null){m='["null"';for(const b in c)u.push(ft(b)),m+=`,${fe(b)},${p(c[b])}`,u.pop();m+="]"}else{m="{";let b=!1;for(const P in c)b&&(m+=","),b=!0,u.push(ft(P)),m+=`${fe(P)}:${p(c[P])}`,u.pop();m+="}"}}}return i[A]=m,A}const y=p(n);return y<0?`${y}`:`[${i.join(",")}]`}function Re(n){const r=typeof n;return r==="string"?fe(n):n instanceof String?fe(n.toString()):n===void 0?gt.toString():n===0&&1/n<0?bt.toString():r==="bigint"?`["BigInt","${n}"]`:String(n)}function me(n){const r={}.toString.call(n).slice(8,-1);if(r=="Set")return new Set([...n].map(i=>me(i)));if(r=="Map")return new Map([...n].map(i=>[me(i[0]),me(i[1])]));if(r=="Date")return new Date(n.getTime());if(r=="RegExp")return RegExp(n.source,n.flags);if(r=="Array"||r=="Object"){const i=r=="Object"?Object.create(Object.getPrototypeOf(n)):[];for(const e in n)i[e]=me(n[e]);return i}return n}function Le(n,r,i){return n[r]=i,"skip"}function fn(n,r){return r.value!==void 0&&typeof r.value!="object"&&r.path.length<n.length}function Q(n,r,i={}){i.modifier||(i.modifier=f=>fn(r,f)?void 0:f.value);const e=J(n,r,i.modifier);if(e)return i.value===void 0||i.value(e.value)?e:void 0}function J(n,r,i){if(!r.length)return;const e=[r[0]];let f=n;for(;f&&e.length<r.length;){const a=e[e.length-1],p=i?i({parent:f,key:String(a),value:f[a],path:e.map(y=>String(y)),isLeaf:!1,set:y=>Le(f,a,y)}):f[a];if(p===void 0)return;f=p,e.push(r[e.length])}if(!f)return;const u=r[r.length-1];return{parent:f,key:String(u),value:f[u],path:r.map(a=>String(a)),isLeaf:!0,set:a=>Le(f,u,a)}}function X(n,r,i=[]){for(const e in n){const f=n[e],u=f===null||typeof f!="object",a={parent:n,key:e,value:f,path:i.concat([e]),isLeaf:u,set:y=>Le(n,e,y)},p=r(a);if(p==="abort")return p;if(p==="skip")continue;if(!u){const y=X(f,r,a.path);if(y==="abort")return y}}}function ln(n,r){return n===r||n.size===r.size&&[...n].every(i=>r.has(i))}function lt(n,r){const i=new Map;function e(a,p){return a instanceof Date&&p instanceof Date&&a.getTime()!==p.getTime()||a instanceof Set&&p instanceof Set&&!ln(a,p)||a instanceof File&&p instanceof File&&a!==p}function f(a){return a instanceof Date||a instanceof Set||a instanceof File}function u(a,p){const y=p?J(p,a.path):void 0;function c(){return i.set(a.path.join(" "),a.path),"skip"}if(f(a.value)&&(!f(y==null?void 0:y.value)||e(a.value,y.value)))return c();a.isLeaf&&(!y||a.value!==y.value)&&c()}return X(n,a=>u(a,r)),X(r,a=>u(a,n)),Array.from(i.values())}function G(n,r,i){const e=typeof i=="function";for(const f of r){const u=J(n,f,({parent:a,key:p,value:y})=>((y===void 0||typeof y!="object")&&(a[p]={}),a[p]));u&&(u.parent[u.key]=e?i(f,u):i)}}function le(n){return n.toString().split(/[[\].]+/).filter(r=>r)}function ye(n){return n.reduce((r,i)=>{const e=String(i);return typeof i=="number"||/^\d+$/.test(e)?r+=`[${e}]`:r?r+=`.${e}`:r+=e,r},"")}const ct=n=>{if(typeof n=="object"&&n!==null){if(typeof Object.getPrototypeOf=="function"){const r=Object.getPrototypeOf(n);return r===Object.prototype||r===null}return Object.prototype.toString.call(n)==="[object Object]"}return!1},W=(...n)=>n.reduce((r,i)=>{if(Array.isArray(i))throw new TypeError("Arguments provided to ts-deepmerge must be objects, not arrays.");return Object.keys(i).forEach(e=>{["__proto__","constructor","prototype"].includes(e)||(Array.isArray(r[e])&&Array.isArray(i[e])?r[e]=W.options.mergeArrays?W.options.uniqueArrayItems?Array.from(new Set(r[e].concat(i[e]))):[...r[e],...i[e]]:i[e]:ct(r[e])&&ct(i[e])?r[e]=W(r[e],i[e]):r[e]=i[e]===void 0?W.options.allowUndefinedOverrides?i[e]:r[e]:i[e])}),r},{}),Ve={allowUndefinedOverrides:!0,mergeArrays:!0,uniqueArrayItems:!0};W.options=Ve;W.withOptions=(n,...r)=>{W.options=Object.assign(Object.assign({},Ve),n);const i=W(...r);return W.options=Ve,i};const cn=["unix-time","bigint","any","symbol","set","int64"];function ht(n,r,i){var y;if(Ye(n,i),n.allOf&&n.allOf.length)return{...W.withOptions({allowUndefinedOverrides:!1},...n.allOf.map(c=>ht(c,!1,[]))),schema:n};const e=wt(n,i),f=n.items&&e.includes("array")?(Array.isArray(n.items)?n.items:[n.items]).filter(c=>typeof c!="boolean"):void 0,u=n.additionalProperties&&typeof n.additionalProperties=="object"&&e.includes("object")?Object.fromEntries(Object.entries(n.additionalProperties).filter(([,c])=>typeof c!="boolean")):void 0,a=n.properties&&e.includes("object")?Object.fromEntries(Object.entries(n.properties).filter(([,c])=>typeof c!="boolean")):void 0,p=(y=dn(n))==null?void 0:y.filter(c=>c.type!=="null"&&c.const!==null);return{types:e.filter(c=>c!=="null"),isOptional:r,isNullable:e.includes("null"),schema:n,union:p!=null&&p.length?p:void 0,array:f,properties:a,additionalProperties:u,required:n.required}}function wt(n,r){Ye(n,r);let i=n.const===null?["null"]:[];if(n.type&&(i=Array.isArray(n.type)?n.type:[n.type]),n.anyOf&&(i=n.anyOf.flatMap(e=>wt(e,r))),i.includes("array")&&n.uniqueItems){const e=i.findIndex(f=>f!="array");i[e]="set"}else if(n.format&&cn.includes(n.format)&&(i.unshift(n.format),n.format=="unix-time"||n.format=="int64")){const e=i.findIndex(f=>f=="integer");i.splice(e,1)}return n.const&&n.const!==null&&typeof n.const!="function"&&i.push(typeof n.const),Array.from(new Set(i))}function dn(n){if(!(!n.anyOf||!n.anyOf.length))return n.anyOf.filter(r=>typeof r!="boolean")}class F extends Error{constructor(r){super(r),Object.setPrototypeOf(this,F.prototype)}}class _e extends F{constructor(i,e){super((e&&e.length?`[${Array.isArray(e)?e.join("."):e}] `:"")+i);it(this,"path");this.path=Array.isArray(e)?e.join("."):e,Object.setPrototypeOf(this,_e.prototype)}}function pn(n,r){var f;const i={};function e(u){if("_errors"in i||(i._errors=[]),!Array.isArray(i._errors))if(typeof i._errors=="string")i._errors=[i._errors];else throw new F("Form-level error was not an array.");i._errors.push(u.message)}for(const u of n){if(!u.path||u.path.length==1&&!u.path[0]){e(u);continue}const p=!/^\d$/.test(String(u.path[u.path.length-1]))&&((f=Q(r,u.path.filter(m=>/\D/.test(String(m)))))==null?void 0:f.value),y=J(i,u.path,({value:m,parent:R,key:B})=>(m===void 0&&(R[B]={}),R[B]));if(!y){e(u);continue}const{parent:c,key:A}=y;p?(A in c||(c[A]={}),"_errors"in c[A]?c[A]._errors.push(u.message):c[A]._errors=[u.message]):A in c?c[A].push(u.message):c[A]=[u.message]}return i}function dt(n,r,i){return i?n:(X(r,e=>{Array.isArray(e.value)&&e.set(void 0)}),X(n,e=>{!Array.isArray(e.value)&&e.value!==void 0||G(r,[e.path],e.value)}),r)}function mn(n){return vt(n,[])}function vt(n,r){return Object.entries(n).filter(([,e])=>e!==void 0).flatMap(([e,f])=>{if(Array.isArray(f)&&f.length>0){const u=r.concat([e]);return{path:ye(u),messages:f}}else return vt(n[e],r.concat([e]))})}function q(n){return n&&typeof n=="object"?me(n):n}function Ye(n,r){if(typeof n=="boolean")throw new _e("Schema property cannot be defined as boolean.",r)}function pt(n){n.flashMessage&&$e(n)&&(document.cookie=`flash=; Max-Age=0; Path=${n.flashMessage.cookiePath??"/"};`)}function $e(n){return n.flashMessage?n.syncFlashMessage:!1}const Et="noCustomValidity";async function mt(n,r){"setCustomValidity"in n&&n.setCustomValidity(""),!(Et in n.dataset)&&At(n,r)}function yn(n,r){for(const i of n.querySelectorAll("input,select,textarea,button")){if("dataset"in i&&Et in i.dataset||!i.name)continue;const e=J(r,le(i.name)),f=e&&typeof e.value=="object"&&"_errors"in e.value?e.value._errors:e==null?void 0:e.value;if(At(i,f),f)return}}function At(n,r){const i=r&&r.length?r.join(`
`):"";n.setCustomValidity(i),i&&n.reportValidity()}const gn=(n,r=0)=>{const i=n.getBoundingClientRect();return i.top>=r&&i.left>=0&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&i.right<=(window.innerWidth||document.documentElement.clientWidth)},bn=(n,r=1.125,i="smooth")=>{const u=n.getBoundingClientRect().top+window.pageYOffset-window.innerHeight/(2*r);window.scrollTo({left:0,top:u,behavior:i})},hn=["checkbox","radio","range","file"];function yt(n){const r=!!n&&(n instanceof HTMLSelectElement||n instanceof HTMLInputElement&&hn.includes(n.type)),i=!!n&&n instanceof HTMLSelectElement&&n.multiple,e=!!n&&n instanceof HTMLInputElement&&n.type=="file";return{immediate:r,multiple:i,file:e}}var D;(function(n){n[n.Idle=0]="Idle",n[n.Submitting=1]="Submitting",n[n.Delayed=2]="Delayed",n[n.Timeout=3]="Timeout"})(D||(D={}));const wn=new Set;function vn(n,r,i){let e=D.Idle,f,u;const a=wn;function p(){y(),A(e!=D.Delayed?D.Submitting:D.Delayed),f=window.setTimeout(()=>{f&&e==D.Submitting&&A(D.Delayed)},i.delayMs),u=window.setTimeout(()=>{u&&e==D.Delayed&&A(D.Timeout)},i.timeoutMs),a.add(y)}function y(){clearTimeout(f),clearTimeout(u),f=u=0,a.delete(y),A(D.Idle)}function c(){a.forEach(b=>b()),a.clear()}function A(b){e=b,r.submitting.set(e>=D.Submitting),r.delayed.set(e>=D.Delayed),r.timeout.set(e>=D.Timeout)}const m=n;function R(b){const P=b.target;i.selectErrorText&&P.select()}function B(){i.selectErrorText&&m.querySelectorAll("input").forEach(b=>{b.addEventListener("invalid",R)})}function C(){i.selectErrorText&&m.querySelectorAll("input").forEach(b=>b.removeEventListener("invalid",R))}const ee=n;{B();const b=P=>{P.clearAll?c():y(),P.cancelled||setTimeout(()=>Ue(ee,i),1)};return Se(()=>{C(),b({cancelled:!0})}),{submitting(){p()},completed:b,scrollToFirstError(){setTimeout(()=>Ue(ee,i),1)},isSubmitting:()=>e===D.Submitting||e===D.Delayed}}}const Ue=async(n,r)=>{if(r.scrollToError=="off")return;const i=r.errorSelector;if(!i)return;await Ce();let e;if(e=n.querySelector(i),!e)return;e=e.querySelector(i)??e;const f=r.stickyNavbar?document.querySelector(r.stickyNavbar):null;typeof r.scrollToError!="string"?e.scrollIntoView(r.scrollToError):gn(e,(f==null?void 0:f.offsetHeight)??0)||bn(e,void 0,r.scrollToError);function u(p){return typeof r.autoFocusOnError=="boolean"?r.autoFocusOnError:!/iPhone|iPad|iPod|Android/i.test(p)}if(!u(navigator.userAgent))return;let a;if(a=e,["INPUT","SELECT","BUTTON","TEXTAREA"].includes(a.tagName)||(a=a.querySelector('input:not([type="hidden"]):not(.flatpickr-input), select, textarea')),a)try{a.focus({preventScroll:!0}),r.selectErrorText&&a.tagName=="INPUT"&&a.select()}catch{}};function Te(n,r,i){const e=J(n,r,({parent:f,key:u,value:a})=>(a===void 0&&(f[u]=/\D/.test(u)?{}:[]),f[u]));if(e){const f=i(e.value);e.parent[e.key]=f}return n}function En(n,r,i){const e=n.form,f=le(r),u=Be(e,a=>{const p=J(a,f);return p==null?void 0:p.value});return{subscribe(...a){const p=u.subscribe(...a);return()=>p()},update(a,p){e.update(y=>Te(y,f,a),p??i)},set(a,p){e.update(y=>Te(y,f,()=>a),p??i)}}}function An(n,r){const i="form"in n;if(!i&&(r==null?void 0:r.taint)!==void 0)throw new F("If options.taint is set, the whole superForm object must be used as a proxy.");return i}function Ee(n,r,i){const e=le(r);if(An(n,i))return En(n,r,i);const f=Be(n,u=>{const a=J(u,e);return a==null?void 0:a.value});return{subscribe(...u){const a=f.subscribe(...u);return()=>a()},update(u){n.update(a=>Te(a,e,u))},set(u){n.update(a=>Te(a,e,()=>u))}}}function kn(n,r=[]){const i=qe(n,r);if(!i)throw new _e("No shape could be created for schema.",r);return i}function qe(n,r){Ye(n,r);const i=ht(n,!1,r);if(i.array||i.union){const e=i.array||[],f=i.union||[];return e.concat(f).reduce((u,a)=>{const p=qe(a,r);return p&&(u={...u??{},...p}),u},e.length?{}:void 0)}if(i.properties){const e={};for(const[f,u]of Object.entries(i.properties)){const a=qe(u,[...r,f]);a&&(e[f]=a)}return e}return i.types.includes("array")||i.types.includes("object")?{}:void 0}function He(n){let r={};const i=Array.isArray(n);for(const[e,f]of Object.entries(n))!f||typeof f!="object"||(i?r={...r,...He(f)}:r[e]=He(f));return r}const Ae=new WeakMap,oe=new WeakMap,St=n=>{throw n.result.error},Sn={applyAction:!0,invalidateAll:!0,resetForm:!0,autoFocusOnError:"detect",scrollToError:"smooth",errorSelector:'[aria-invalid="true"],[data-invalid]',selectErrorText:!1,stickyNavbar:void 0,taintedMessage:!1,onSubmit:void 0,onResult:void 0,onUpdate:void 0,onUpdated:void 0,onError:St,dataType:"form",validators:void 0,customValidity:!1,clearOnSubmit:"message",delayMs:500,timeoutMs:8e3,multipleSubmits:"prevent",SPA:void 0,validationMethod:"auto"};function Tn(n){return`Duplicate form id's found: "${n}". Multiple forms will receive the same data. Use the id option to differentiate between them, or if this is intended, set the warnings.duplicateId option to false in superForm to disable this warning. More information: https://superforms.rocks/concepts/multiple-forms`}let Tt=!1;try{SUPERFORMS_LEGACY&&(Tt=!0)}catch{}let ue=!1;try{globalThis.STORIES&&(ue=!0)}catch{}function xn(n,r){var rt;let i,e=r??{},f;{if((e.legacy??Tt)&&(e.resetForm===void 0&&(e.resetForm=!1),e.taintedMessage===void 0&&(e.taintedMessage=!0)),ue&&e.applyAction===void 0&&(e.applyAction=!1),typeof e.SPA=="string"&&(e.invalidateAll===void 0&&(e.invalidateAll=!1),e.applyAction===void 0&&(e.applyAction=!1)),f=e.validators,e={...Sn,...e},(e.SPA===!0||typeof e.SPA=="object")&&e.validators===void 0&&console.warn("No validators set for superForm in SPA mode. Add a validation adapter to the validators option, or set it to false to disable this warning."),!n)throw new F("No form data sent to superForm. Make sure the output from superValidate is used (usually data.form) and that it's not null or undefined. Alternatively, an object with default values for the form can also be used, but then constraints won't be available.");c(n)===!1&&(n={id:e.id??Math.random().toString(36).slice(2,10),valid:!1,posted:!1,errors:{},data:n,shape:He(n)}),n=n;const t=n.id=e.id??n.id,s=pe(de)??(ue?{}:void 0);if(((rt=e.warnings)==null?void 0:rt.duplicateId)!==!1)if(!Ae.has(s))Ae.set(s,new Set([t]));else{const o=Ae.get(s);o!=null&&o.has(t)?console.warn(Tn(t)):o==null||o.add(t)}if(oe.has(n)||oe.set(n,n),i=oe.get(n),n=q(i),Se(()=>{var o;Lt(),Pt(),Ut();for(const l of Object.values(V))l.length=0;(o=Ae.get(s))==null||o.delete(t)}),e.dataType!=="json"){const o=(l,d)=>{if(!(!d||typeof d!="object")){if(Array.isArray(d))d.length>0&&o(l,d[0]);else if(!(d instanceof Date)&&!(d instanceof File)&&!(d instanceof FileList))throw new F(`Object found in form field "${l}". Set the dataType option to "json" and add use:enhance to use nested data structures. More information: https://superforms.rocks/concepts/nested-data`)}};for(const[l,d]of Object.entries(n.data))o(l,d)}}const u={formId:n.id,form:q(n.data),constraints:n.constraints??{},posted:n.posted,errors:q(n.errors),message:q(n.message),tainted:void 0,valid:n.valid,submitting:!1,shape:n.shape},a=u,p=z(e.id??n.id);function y(t){return Object.values(t).filter(o=>c(o)!==!1)}function c(t){return!t||typeof t!="object"||!("valid"in t&&"errors"in t&&typeof t.valid=="boolean")?!1:"id"in t&&typeof t.id=="string"?t.id:!1}const A=z(n.data),m={subscribe:A.subscribe,set:(t,s={})=>{const o=q(t);return Ke(o,s.taint??!0),A.set(o)},update:(t,s={})=>A.update(o=>{const l=t(o);return Ke(l,s.taint??!0),l})};function R(){return e.SPA===!0||typeof e.SPA=="object"}function B(t){var s;return t>400?t:(typeof e.SPA=="boolean"||typeof e.SPA=="string"||(s=e.SPA)==null?void 0:s.failStatus)||t}async function C(t={}){const s=t.formData??a.form;let o={},l;const d=t.adapter??e.validators;if(typeof d=="object"){if(d!=f&&!("jsonSchema"in d))throw new F('Client validation adapter found in options.validators. A full adapter must be used when changing validators dynamically, for example "zod" instead of "zodClient".');if(l=await d.validate(s),!l.success)o=pn(l.issues,d.shape??a.shape??{});else if(t.recheckValidData!==!1)return C({...t,recheckValidData:!1})}else l={success:!0,data:{}};const h={...a.form,...s,...l.success?l.data:{}};return{valid:l.success,posted:!1,errors:o,data:h,constraints:a.constraints,message:void 0,id:a.formId,shape:a.shape}}function ee(t){if(!e.onChange||!t.paths.length||t.type=="blur")return;let s;const o=t.paths.map(ye);t.type&&t.paths.length==1&&t.formElement&&t.target instanceof Element?s={path:o[0],paths:o,formElement:t.formElement,target:t.target,set(l,d,h){Ee({form:m},l,h).set(d)},get(l){return pe(Ee(m,l))}}:s={paths:o,target:void 0,set(l,d,h){Ee({form:m},l,h).set(d)},get(l){return pe(Ee(m,l))}},e.onChange(s)}async function b(t,s=!1,o){t&&(e.validators=="clear"&&Y.update(h=>(G(h,t.paths,void 0),h)),setTimeout(()=>ee(t)));let l=!1;if(s||(e.validationMethod=="onsubmit"||e.validationMethod=="submit-only"||e.validationMethod=="onblur"&&(t==null?void 0:t.type)=="input"||e.validationMethod=="oninput"&&(t==null?void 0:t.type)=="blur")&&(l=!0),l||!t||!e.validators||e.validators=="clear"){if(t!=null&&t.paths){const h=(t==null?void 0:t.formElement)??ce();h&&P(h)}return}const d=await C({adapter:o});return d.valid&&(t.immediate||t.type!="input")&&m.set(d.data,{taint:"ignore"}),await Ce(),_t(d.errors,t,s),d}function P(t){const s=new Map;if(e.customValidity&&t)for(const o of t.querySelectorAll("[name]")){if(typeof o.name!="string"||!o.name.length)continue;const l="validationMessage"in o?String(o.validationMessage):"";s.set(o.name,{el:o,message:l}),mt(o,void 0)}return s}async function _t(t,s,o){const{type:l,immediate:d,multiple:h,paths:$}=s,K=a.errors,te={};let x=new Map;const j=s.formElement??ce();j&&(x=P(j)),X(t,S=>{if(!Array.isArray(S.value))return;const I=[...S.path];I[I.length-1]=="_errors"&&I.pop();const ae=I.join(".");function U(){if(G(te,[S.path],S.value),e.customValidity&&ne&&x.has(ae)){const{el:N,message:re}=x.get(ae);re!=S.value&&(setTimeout(()=>mt(N,S.value)),x.clear())}}if(o)return U();const we=S.path[S.path.length-1]=="_errors",ne=S.value&&$.some(N=>we?N&&I.length>0&&I[0]==N[0]:ae==N.join("."));if(ne&&e.validationMethod=="oninput"||d&&!h&&ne)return U();if(h){const N=Q(pe(Y),S.path.slice(0,-1));if(N!=null&&N.value&&typeof(N==null?void 0:N.value)=="object"){for(const re of Object.values(N.value))if(Array.isArray(re))return U()}}const Z=Q(K,S.path);if(Z&&Z.key in Z.parent)return U();if(we){if(e.validationMethod=="oninput"||l=="blur"&&Nt(ye(S.path.slice(0,-1))))return U()}else if(l=="blur"&&ne)return U()}),Y.set(te)}function Ot(t,s={}){return s.keepFiles&&X(a.form,o=>{if(!(o.parent instanceof FileList)&&(o.value instanceof File||o.value instanceof FileList)){const l=Q(t,o.path);(!l||!(l.key in l.parent))&&G(t,[o.path],o.value)}}),m.set(t,s)}function ge(t,s){return t&&s&&e.resetForm&&(e.resetForm===!0||e.resetForm())}function Mt(t=!0){let s=a.form,o=a.tainted;if(t){const l=Ht(a.form);s=l.data;const d=l.paths;d.length&&(o=q(o)??{},G(o,d,!1))}return{valid:a.valid,posted:a.posted,errors:a.errors,data:s,constraints:a.constraints,message:a.message,id:a.formId,tainted:o,shape:a.shape}}async function ze(t,s){t.valid&&s&&ge(t.valid,s)?Oe({message:t.message,posted:!0}):he({form:t,untaint:s,keepFiles:!0,skipFormData:e.invalidateAll=="force"}),V.onUpdated.length&&await Ce();for(const o of V.onUpdated)o({form:t})}function Oe(t={}){t.newState&&(i.data={...i.data,...t.newState});const s=q(i);s.data={...s.data,...t.data},t.id!==void 0&&(s.id=t.id),he({form:s,untaint:!0,message:t.message,keepFiles:!1,posted:t.posted,resetted:!0})}async function Ft(t){if(t.type=="error")throw new F(`ActionResult of type "${t.type}" cannot be passed to update function.`);if(t.type=="redirect"){ge(!0,!0)&&Oe({posted:!0});return}if(typeof t.data!="object")throw new F("Non-object validation data returned from ActionResult.");const s=y(t.data);if(!s.length)throw new F("No form data returned from ActionResult. Make sure you return { form } in the form actions.");for(const o of s)o.id===a.formId&&await ze(o,t.status>=200&&t.status<300)}const se=z(u.message),Me=z(u.constraints),Fe=z(u.posted),Ge=z(u.shape),je=z(n.errors),Y={subscribe:je.subscribe,set(t,s){return je.set(dt(t,a.errors,s==null?void 0:s.force))},update(t,s){return je.update(o=>dt(t(o),a.errors,s==null?void 0:s.force))},clear:()=>Y.set({})};let O=null;function jt(t){var s;O&&t&&Object.keys(t).length==1&&((s=t.paths)!=null&&s.length)&&O.target&&O.target instanceof HTMLInputElement&&O.target.type.toLowerCase()=="file"?O.paths=t.paths:O=t,setTimeout(()=>{b(O)},0)}function It(t,s,o,l,d){O===null&&(O={paths:[]}),O.type=t,O.immediate=s,O.multiple=o,O.formElement=l,O.target=d}function We(){return(O==null?void 0:O.paths)??[]}function Pt(){O=null}const k={defaultMessage:"Leave page? Changes that you made may not be saved.",state:z(),message:e.taintedMessage,clean:q(n.data),forceRedirection:!1};function Je(){return e.taintedMessage&&!a.submitting&&!k.forceRedirection&&Xe()}function Ze(t){if(!Je())return;t.preventDefault(),t.returnValue="";const{taintedMessage:s}=e,l=typeof s=="function"||s===!0?k.defaultMessage:s;return(t||window.event).returnValue=l||k.defaultMessage,l}async function kt(t){if(!Je())return;const{taintedMessage:s}=e,o=typeof s=="function";if(o&&t.cancel(),t.type==="leave")return;const l=o||s===!0?k.defaultMessage:s;let d;try{d=o?await s():window.confirm(l||k.defaultMessage)}catch{d=!1}if(d&&t.to)try{k.forceRedirection=!0,await Qt(t.to.url,{...t.to.params});return}finally{k.forceRedirection=!1}else!d&&!o&&t.cancel()}function xt(){e.taintedMessage=k.message}function Dt(){return k.state}function Nt(t){if(!a.tainted)return!1;if(!t)return!!a.tainted;const s=Q(a.tainted,le(t));return!!s&&s.key in s.parent}function Xe(t){if(!arguments.length)return be(a.tainted);if(typeof t=="boolean")return t;if(typeof t=="object")return be(t);if(!a.tainted||t===void 0)return!1;const s=Q(a.tainted,le(t));return be(s==null?void 0:s.value)}function be(t){if(!t)return!1;if(typeof t=="object"){for(const s of Object.values(t))if(be(s))return!0}return t===!0}function Ke(t,s){if(s=="ignore")return;const o=lt(t,a.form),l=lt(t,k.clean).map(d=>d.join());o.length&&(s=="untaint-all"||s=="untaint-form"?k.state.set(void 0):k.state.update(d=>(d||(d={}),G(d,o,(h,$)=>{if(!l.includes(h.join()))return;const K=J(t,h),te=J(k.clean,h);return K&&te&&K.value===te.value?void 0:s===!0?!0:s==="untaint"?void 0:$.value}),d)),jt({paths:o}))}function Rt(t,s){k.state.set(t),s&&(k.clean=s)}const Ie=z(!1),Qe=z(!1),et=z(!1),tt=[k.state.subscribe(t=>u.tainted=q(t)),m.subscribe(t=>u.form=q(t)),Y.subscribe(t=>u.errors=q(t)),p.subscribe(t=>u.formId=t),Me.subscribe(t=>u.constraints=t),Fe.subscribe(t=>u.posted=t),se.subscribe(t=>u.message=t),Ie.subscribe(t=>u.submitting=t),Ge.subscribe(t=>u.shape=t)];function Ct(t){tt.push(t)}function Lt(){tt.forEach(t=>t())}let L;function ce(){return L}function Vt(t){L=document.createElement("form"),L.method="POST",L.action=t,nt(L),document.body.appendChild(L)}function $t(t){L&&(L.action=t)}function Ut(){L!=null&&L.parentElement&&L.remove(),L=void 0}const qt=Be(Y,t=>t?mn(t):[]);e.taintedMessage=void 0;function he(t){const s=t.form,o=t.message??s.message;if((t.untaint||t.resetted)&&Rt(typeof t.untaint=="boolean"?void 0:t.untaint,s.data),t.skipFormData!==!0&&Ot(s.data,{taint:"ignore",keepFiles:t.keepFiles}),se.set(o),t.resetted?Y.update(()=>({}),{force:!0}):Y.set(s.errors),p.set(s.id),Fe.set(t.posted??s.posted),s.constraints&&Me.set(s.constraints),s.shape&&Ge.set(s.shape),u.valid=s.valid,e.flashMessage&&$e(e)){const l=e.flashMessage.module.getFlash(de);o&&pe(l)===void 0&&l.set(o)}}const V={onSubmit:e.onSubmit?[e.onSubmit]:[],onResult:e.onResult?[e.onResult]:[],onUpdate:e.onUpdate?[e.onUpdate]:[],onUpdated:e.onUpdated?[e.onUpdated]:[],onError:e.onError?[e.onError]:[]};window.addEventListener("beforeunload",Ze),Se(()=>{window.removeEventListener("beforeunload",Ze)}),Xt(kt),Ct(de.subscribe(async t=>{ue&&t===void 0&&(t={status:200});const s=t.status>=200&&t.status<300;if(e.applyAction&&t.form&&typeof t.form=="object"){const o=t.form;if(o.type==="error")return;for(const l of y(o)){const d=oe.has(l);l.id!==a.formId||d||(oe.set(l,l),await ze(l,s))}}else if(t.data&&typeof t.data=="object")for(const o of y(t.data)){const l=oe.has(o);if(o.id!==a.formId||l)continue;e.invalidateAll==="force"&&(i.data=o.data);const d=ge(o.valid,!0);he({form:o,untaint:s,keepFiles:!d,resetted:d})}})),typeof e.SPA=="string"&&Vt(e.SPA);function nt(t,s){if(e.SPA!==void 0&&t.method=="get"&&(t.method="post"),typeof e.SPA=="string"?e.SPA.length&&t.action==document.location.href&&(t.action=e.SPA):L=t,s){if(s.onError){if(e.onError==="apply")throw new F('options.onError is set to "apply", cannot add any onError events.');if(s.onError==="apply")throw new F('Cannot add "apply" as onError event in use:enhance.');V.onError.push(s.onError)}s.onResult&&V.onResult.push(s.onResult),s.onSubmit&&V.onSubmit.push(s.onSubmit),s.onUpdate&&V.onUpdate.push(s.onUpdate),s.onUpdated&&V.onUpdated.push(s.onUpdated)}xt();let o;async function l(x){const j=yt(x.target);j.immediate&&!j.file&&await new Promise(S=>setTimeout(S,0)),o=We(),It("input",j.immediate,j.multiple,t,x.target??void 0)}async function d(x){if(a.submitting||!o||We()!=o)return;const j=yt(x.target);j.immediate&&!j.file&&await new Promise(S=>setTimeout(S,0)),b({paths:o,immediate:j.multiple,multiple:j.multiple,type:"blur",formElement:t,target:x.target??void 0}),o=void 0}t.addEventListener("focusout",d),t.addEventListener("input",l),Se(()=>{t.removeEventListener("focusout",d),t.removeEventListener("input",l)});const h=vn(t,{submitting:Ie,delayed:Qe,timeout:et},e);let $,K;const te=en(t,async x=>{let j,S=e.validators;const I={...x,jsonData(w){if(e.dataType!=="json")throw new F("options.dataType must be set to 'json' to use jsonData.");j=w},validators(w){S=w},customRequest(w){K=w}},ae=I.cancel;let U=!1;function Pe(w){const g={...w,posted:!0},v=g.valid?200:B(400),M={form:g},T=g.valid?{type:"success",status:v,data:M}:{type:"failure",status:v,data:M};setTimeout(()=>re({result:T}),0)}function we(){switch(e.clearOnSubmit){case"errors-and-message":Y.clear(),se.set(void 0);break;case"errors":Y.clear();break;case"message":se.set(void 0);break}}async function ne(w,g){var v;if(w.status=g,e.onError!=="apply"){const M={result:w,message:se,form:n};for(const T of V.onError)T!=="apply"&&(T!=St||!((v=e.flashMessage)!=null&&v.onError))&&await T(M)}e.flashMessage&&e.flashMessage.onError&&await e.flashMessage.onError({result:w,flashMessage:e.flashMessage.module.getFlash(de)}),e.applyAction&&(e.onError=="apply"?await De(w):await De({type:"failure",status:B(w.status),data:w}))}function Z(w={resetTimers:!0}){return U=!0,w.resetTimers&&h.isSubmitting()&&h.completed({cancelled:U}),ae()}if(I.cancel=Z,h.isSubmitting()&&e.multipleSubmits=="prevent")Z({resetTimers:!1});else{h.isSubmitting()&&e.multipleSubmits=="abort"&&$&&$.abort(),h.submitting(),$=I.controller;for(const w of V.onSubmit)try{await w(I)}catch(g){Z(),ne({type:"error",error:g},500)}}if(U&&e.flashMessage&&pt(e),!U){const w=!R()&&(t.noValidate||(I.submitter instanceof HTMLButtonElement||I.submitter instanceof HTMLInputElement)&&I.submitter.formNoValidate);let g;const v=async()=>await C({adapter:S});if(we(),w||(g=await v(),g.valid||(Z({resetTimers:!1}),Pe(g))),!U){e.flashMessage&&(e.clearOnSubmit=="errors-and-message"||e.clearOnSubmit=="message")&&$e(e)&&e.flashMessage.module.getFlash(de).set(void 0);const M="formData"in I?I.formData:I.data;if(o=void 0,R())g||(g=await v()),Z({resetTimers:!1}),Pe(g);else if(e.dataType==="json"){g||(g=await v());const T=q(j??g.data);X(T,E=>{if(E.value instanceof File){const _="__superform_file_"+ye(E.path);return M.append(_,E.value),E.set(void 0)}else if(Array.isArray(E.value)&&E.value.length&&E.value.every(_=>_ instanceof File)){const _="__superform_files_"+ye(E.path);for(const H of E.value)M.append(_,H);return E.set(void 0)}}),Object.keys(T).forEach(E=>{typeof M.get(E)=="string"&&M.delete(E)});const ie=e.transport?Object.fromEntries(Object.entries(e.transport).map(([E,_])=>[E,_.encode])):void 0,ve=N(un(T,ie),e.jsonChunkSize??5e5);for(const E of ve)M.append("__superform_json",E)}if(!M.has("__superform_id")){const T=a.formId;T!==void 0&&M.set("__superform_id",T)}typeof e.SPA=="string"&&$t(e.SPA)}}function N(w,g){const v=Math.ceil(w.length/g),M=new Array(v);for(let T=0,ie=0;T<v;++T,ie+=g)M[T]=w.substring(ie,ie+g);return M}async function re(w){let g=!1;$=null;let v="type"in w.result&&"status"in w.result?w.result:{type:"error",status:B(parseInt(String(w.result.status))||500),error:w.result.error instanceof Error?w.result.error:w.result};const M=()=>g=!0,T={result:v,formEl:t,formElement:t,cancel:M},ie=ue||!R()?()=>{}:st.subscribe(E=>{var _,H;!E||((_=E.from)==null?void 0:_.route.id)===((H=E.to)==null?void 0:H.route.id)||M()});function ve(E,_,H){_.result={type:"error",error:E,status:B(H)}}for(const E of V.onResult)try{await E(T)}catch(_){ve(_,T,Math.max(v.status??500,400))}if(v=T.result,!g){if((v.type==="success"||v.type==="failure")&&v.data){const E=y(v.data);if(!E.length)throw new F("No form data returned from ActionResult. Make sure you return { form } in the form actions.");for(const _ of E){if(_.id!==a.formId)continue;const H={form:_,formEl:t,formElement:t,cancel:()=>g=!0,result:v};for(const ke of V.onUpdate)try{await ke(H)}catch(Bt){ve(Bt,H,Math.max(v.status??500,400))}v=H.result,g||(e.customValidity&&yn(t,H.form.errors),ge(H.form.valid,v.type=="success")&&H.formElement.querySelectorAll('input[type="file"]').forEach(ke=>ke.value=""))}}g||(v.type!=="error"?(v.type==="success"&&e.invalidateAll&&await Kt(),e.applyAction?await De(v):await Ft(v)):await ne(v,Math.max(v.status??500,400)))}if(g&&e.flashMessage&&pt(e),g||v.type!="redirect")h.completed({cancelled:g});else if(ue)h.completed({cancelled:g,clearAll:!0});else{const E=st.subscribe(_=>{_||(setTimeout(()=>{try{E&&E()}catch{}}),h.isSubmitting()&&h.completed({cancelled:g,clearAll:!0}))})}ie()}if(!U&&K){ae();const w=await K(x);let g;w instanceof Response?g=ot(await w.text()):w instanceof XMLHttpRequest?g=ot(w.responseText):g=w,g.type==="error"&&(g.status=w.status),re({result:g})}return re});return{destroy:()=>{for(const[x,j]of Object.entries(V))V[x]=j.filter(S=>S===e[x]);te.destroy()}}}function Ht(t){const s=[];if(X(t,l=>{if(l.value instanceof File)return s.push(l.path),"skip";if(Array.isArray(l.value)&&l.value.length&&l.value.every(d=>d instanceof File))return s.push(l.path),"skip"}),!s.length)return{data:t,paths:s};const o=q(t);return G(o,s,l=>{var d;return(d=Q(i.data,l))==null?void 0:d.value}),{data:o,paths:s}}return{form:m,formId:p,errors:Y,message:se,constraints:Me,tainted:Dt(),submitting:xe(Ie),delayed:xe(Qe),timeout:xe(et),options:e,capture:Mt,restore:t=>{he({form:t,untaint:t.tainted??!0})},async validate(t,s={}){if(!e.validators)throw new F("options.validators must be set to use the validate method.");s.update===void 0&&(s.update=!0),s.taint===void 0&&(s.taint=!1),typeof s.errors=="string"&&(s.errors=[s.errors]);let o;const l=le(t);"value"in s?s.update===!0||s.update==="value"?(m.update($=>(G($,[l],s.value),$),{taint:s.taint}),o=a.form):(o=q(a.form),G(o,[l],s.value)):o=a.form;const d=await C({formData:o}),h=Q(d.errors,l);return h&&h.value&&s.errors&&(h.value=s.errors),(s.update===!0||s.update=="errors")&&Y.update($=>(G($,[l],h==null?void 0:h.value),$)),h==null?void 0:h.value},async validateForm(t={}){if(!e.validators&&!t.schema)throw new F("options.validators or the schema option must be set to use the validateForm method.");const s=t.update?await b({paths:[]},!0,t.schema):C({adapter:t.schema}),o=ce();return t.update&&o&&setTimeout(()=>{o&&Ue(o,{...e,scrollToError:t.focusOnError===!1?"off":e.scrollToError})},1),s||C({adapter:t.schema})},allErrors:qt,posted:Fe,reset(t){return Oe({message:t!=null&&t.keepMessage?a.message:void 0,data:t==null?void 0:t.data,id:t==null?void 0:t.id,newState:t==null?void 0:t.newState})},submit(t){const s=ce()?ce():t&&t instanceof HTMLElement?t.closest("form"):void 0;if(!s)throw new F("use:enhance must be added to the form to use submit, or pass a HTMLElement inside the form (or the form itself) as an argument.");if(!s.requestSubmit)return s.submit();const o=t&&(t instanceof HTMLButtonElement&&t.type=="submit"||t instanceof HTMLInputElement&&["submit","image"].includes(t.type));s.requestSubmit(o?t:void 0)},isTainted:Xe,enhance:nt}}new TextEncoder;let _n=!1;try{SUPERFORMS_LEGACY&&(_n=!0)}catch{}export{_e as S,ht as a,Ye as b,F as c,kn as d,W as m,xn as s};
