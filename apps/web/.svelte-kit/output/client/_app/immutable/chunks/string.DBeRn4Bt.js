function d(r){return typeof r!="object"&&typeof r!="function"||r===null}function c(){this.childBranches=new WeakMap,this.primitiveKeys=new Map,this.hasValue=!1,this.value=void 0}c.prototype.has=function(t){var a=d(t)?this.primitiveKeys.get(t):t;return a?this.childBranches.has(a):!1};c.prototype.get=function(t){var a=d(t)?this.primitiveKeys.get(t):t;return a?this.childBranches.get(a):void 0};c.prototype.resolveBranch=function(t){if(this.has(t))return this.get(t);var a=new c,e=this.createKey(t);return this.childBranches.set(e,a),a};c.prototype.setValue=function(t){return this.hasValue=!0,this.value=t};c.prototype.createKey=function(t){if(d(t)){var a={};return this.primitiveKeys.set(t,a),a}return t};c.prototype.clear=function(){if(arguments.length===0)this.childBranches=new WeakMap,this.primitiveKeys.clear(),this.hasValue=!1,this.value=void 0;else if(arguments.length===1){var t=arguments[0];if(d(t)){var a=this.primitiveKeys.get(t);a&&(this.childBranches.delete(a),this.primitiveKeys.delete(t))}else this.childBranches.delete(t)}else{var e=arguments[0];if(this.has(e)){var i=this.get(e);i.clear.apply(i,Array.prototype.slice.call(arguments,1))}}};var k=function(t){var a=new c;function e(){var i=Array.prototype.slice.call(arguments),o=i.reduce(function(m,n){return m.resolveBranch(n)},a);if(o.hasValue)return o.value;var f=t.apply(null,i);return o.setValue(f)}return e.clear=a.clear.bind(a),e};function A(r,t,a,e){e!=null&&e.errorMessages&&a&&(r.errorMessage={...r.errorMessage,[t]:a})}function g(r,t,a,e,i){r[t]=a,A(r,t,e,i)}let h;const l={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(h===void 0&&(h=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),h),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function F(r,t){const a={type:"string"};if(r.checks)for(const e of r.checks)switch(e.kind){case"min":g(a,"minLength",typeof a.minLength=="number"?Math.max(a.minLength,e.value):e.value,e.message,t);break;case"max":g(a,"maxLength",typeof a.maxLength=="number"?Math.min(a.maxLength,e.value):e.value,e.message,t);break;case"email":switch(t.emailStrategy){case"format:email":u(a,"email",e.message,t);break;case"format:idn-email":u(a,"idn-email",e.message,t);break;case"pattern:zod":s(a,l.email,e.message,t);break}break;case"url":u(a,"uri",e.message,t);break;case"uuid":u(a,"uuid",e.message,t);break;case"regex":s(a,e.regex,e.message,t);break;case"cuid":s(a,l.cuid,e.message,t);break;case"cuid2":s(a,l.cuid2,e.message,t);break;case"startsWith":s(a,RegExp(`^${v(e.value,t)}`),e.message,t);break;case"endsWith":s(a,RegExp(`${v(e.value,t)}$`),e.message,t);break;case"datetime":u(a,"date-time",e.message,t);break;case"date":u(a,"date",e.message,t);break;case"time":u(a,"time",e.message,t);break;case"duration":u(a,"duration",e.message,t);break;case"length":g(a,"minLength",typeof a.minLength=="number"?Math.max(a.minLength,e.value):e.value,e.message,t),g(a,"maxLength",typeof a.maxLength=="number"?Math.min(a.maxLength,e.value):e.value,e.message,t);break;case"includes":{s(a,RegExp(v(e.value,t)),e.message,t);break}case"ip":{e.version!=="v6"&&u(a,"ipv4",e.message,t),e.version!=="v4"&&u(a,"ipv6",e.message,t);break}case"base64url":s(a,l.base64url,e.message,t);break;case"jwt":s(a,l.jwt,e.message,t);break;case"cidr":{e.version!=="v6"&&s(a,l.ipv4Cidr,e.message,t),e.version!=="v4"&&s(a,l.ipv6Cidr,e.message,t);break}case"emoji":s(a,l.emoji(),e.message,t);break;case"ulid":{s(a,l.ulid,e.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{u(a,"binary",e.message,t);break}case"contentEncoding:base64":{g(a,"contentEncoding","base64",e.message,t);break}case"pattern:zod":{s(a,l.base64,e.message,t);break}}break}case"nanoid":s(a,l.nanoid,e.message,t)}return a}function v(r,t){return t.patternStrategy==="escape"?y(r):r}const M=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function y(r){let t="";for(let a=0;a<r.length;a++)M.has(r[a])||(t+="\\"),t+=r[a];return t}function u(r,t,a,e){var i;r.format||(i=r.anyOf)!=null&&i.some(o=>o.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&e.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:t,...a&&e.errorMessages&&{errorMessage:{format:a}}})):g(r,"format",t,a,e)}function s(r,t,a,e){var i;r.pattern||(i=r.allOf)!=null&&i.some(o=>o.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&e.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:b(t,e),...a&&e.errorMessages&&{errorMessage:{pattern:a}}})):g(r,"pattern",b(t,e),a,e)}function b(r,t){var m;if(!t.applyRegexFlags||!r.flags)return r.source;const a={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},e=a.i?r.source.toLowerCase():r.source;let i="",o=!1,f=!1,p=!1;for(let n=0;n<e.length;n++){if(o){i+=e[n],o=!1;continue}if(a.i){if(f){if(e[n].match(/[a-z]/)){p?(i+=e[n],i+=`${e[n-2]}-${e[n]}`.toUpperCase(),p=!1):e[n+1]==="-"&&((m=e[n+2])!=null&&m.match(/[a-z]/))?(i+=e[n],p=!0):i+=`${e[n]}${e[n].toUpperCase()}`;continue}}else if(e[n].match(/[a-z]/)){i+=`[${e[n]}${e[n].toUpperCase()}]`;continue}}if(a.m){if(e[n]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(e[n]==="$"){i+=`($|(?=[\r
]))`;continue}}if(a.s&&e[n]==="."){i+=f?`${e[n]}\r
`:`[${e[n]}\r
]`;continue}i+=e[n],e[n]==="\\"?o=!0:f&&e[n]==="]"?f=!1:!f&&e[n]==="["&&(f=!0)}try{new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return i}export{A as a,k as m,F as p,g as s};
