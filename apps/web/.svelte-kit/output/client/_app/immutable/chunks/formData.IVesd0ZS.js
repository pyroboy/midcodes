var Yt=Object.defineProperty;var zt=(t,r,i)=>r in t?Yt(t,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[r]=i;var it=(t,r,i)=>zt(t,typeof r!="symbol"?r+"":r,i);import{d as He,w as z,a as ke}from"./index.CtH2YV38.js";import{p as de,n as st}from"./stores.Cq8_Q5sV.js";import{I as Re,P as Se,a7 as pe}from"./scheduler.Bl--k1HL.js";import{d as Gt,c as Ce,i as Wt,g as Jt}from"./entry.B5jMEGBp.js";import{e as Zt,d as at}from"./forms.BAKYq1CP.js";function me(t){const r={}.toString.call(t).slice(8,-1);if(r=="Set")return new Set([...t].map(i=>me(i)));if(r=="Map")return new Map([...t].map(i=>[me(i[0]),me(i[1])]));if(r=="Date")return new Date(t.getTime());if(r=="RegExp")return RegExp(t.source,t.flags);if(r=="Array"||r=="Object"){const i=r=="Object"?Object.create(Object.getPrototypeOf(t)):[];for(const e in t)i[e]=me(t[e]);return i}return t}function Le(t,r,i){return t[r]=i,"skip"}function Kt(t,r){return r.value!==void 0&&typeof r.value!="object"&&r.path.length<t.length}function Q(t,r,i={}){i.modifier||(i.modifier=f=>Kt(r,f)?void 0:f.value);const e=J(t,r,i.modifier);if(e)return i.value===void 0||i.value(e.value)?e:void 0}function J(t,r,i){if(!r.length)return;const e=[r[0]];let f=t;for(;f&&e.length<r.length;){const a=e[e.length-1],p=i?i({parent:f,key:String(a),value:f[a],path:e.map(y=>String(y)),isLeaf:!1,set:y=>Le(f,a,y)}):f[a];if(p===void 0)return;f=p,e.push(r[e.length])}if(!f)return;const u=r[r.length-1];return{parent:f,key:String(u),value:f[u],path:r.map(a=>String(a)),isLeaf:!0,set:a=>Le(f,u,a)}}function K(t,r,i=[]){for(const e in t){const f=t[e],u=f===null||typeof f!="object",a={parent:t,key:e,value:f,path:i.concat([e]),isLeaf:u,set:y=>Le(t,e,y)},p=r(a);if(p==="abort")return p;if(p==="skip")continue;if(!u){const y=K(f,r,a.path);if(y==="abort")return y}}}function Xt(t,r){return t===r||t.size===r.size&&[...t].every(i=>r.has(i))}function ot(t,r){const i=new Map;function e(a,p){return a instanceof Date&&p instanceof Date&&a.getTime()!==p.getTime()||a instanceof Set&&p instanceof Set&&!Xt(a,p)||a instanceof File&&p instanceof File&&a!==p}function f(a){return a instanceof Date||a instanceof Set||a instanceof File}function u(a,p){const y=p?J(p,a.path):void 0;function l(){return i.set(a.path.join(" "),a.path),"skip"}if(f(a.value)&&(!f(y==null?void 0:y.value)||e(a.value,y.value)))return l();a.isLeaf&&(!y||a.value!==y.value)&&l()}return K(t,a=>u(a,r)),K(r,a=>u(a,t)),Array.from(i.values())}function G(t,r,i){const e=typeof i=="function";for(const f of r){const u=J(t,f,({parent:a,key:p,value:y})=>((y===void 0||typeof y!="object")&&(a[p]={}),a[p]));u&&(u.parent[u.key]=e?i(f,u):i)}}function ce(t){return t.toString().split(/[[\].]+/).filter(r=>r)}function ye(t){return t.reduce((r,i)=>{const e=String(i);return typeof i=="number"||/^\d+$/.test(e)?r+=`[${e}]`:r?r+=`.${e}`:r+=e,r},"")}const ut=t=>{if(typeof t=="object"&&t!==null){if(typeof Object.getPrototypeOf=="function"){const r=Object.getPrototypeOf(t);return r===Object.prototype||r===null}return Object.prototype.toString.call(t)==="[object Object]"}return!1},W=(...t)=>t.reduce((r,i)=>{if(Array.isArray(i))throw new TypeError("Arguments provided to ts-deepmerge must be objects, not arrays.");return Object.keys(i).forEach(e=>{["__proto__","constructor","prototype"].includes(e)||(Array.isArray(r[e])&&Array.isArray(i[e])?r[e]=W.options.mergeArrays?W.options.uniqueArrayItems?Array.from(new Set(r[e].concat(i[e]))):[...r[e],...i[e]]:i[e]:ut(r[e])&&ut(i[e])?r[e]=W(r[e],i[e]):r[e]=i[e]===void 0?W.options.allowUndefinedOverrides?i[e]:r[e]:i[e])}),r},{}),Ve={allowUndefinedOverrides:!0,mergeArrays:!0,uniqueArrayItems:!0};W.options=Ve;W.withOptions=(t,...r)=>{W.options=Object.assign(Object.assign({},Ve),t);const i=W(...r);return W.options=Ve,i};const Qt=["unix-time","bigint","any","symbol","set","int64"];function gt(t,r,i){var y;if(Ye(t,i),t.allOf&&t.allOf.length)return{...W.withOptions({allowUndefinedOverrides:!1},...t.allOf.map(l=>gt(l,!1,[]))),schema:t};const e=bt(t,i),f=t.items&&e.includes("array")?(Array.isArray(t.items)?t.items:[t.items]).filter(l=>typeof l!="boolean"):void 0,u=t.additionalProperties&&typeof t.additionalProperties=="object"&&e.includes("object")?Object.fromEntries(Object.entries(t.additionalProperties).filter(([,l])=>typeof l!="boolean")):void 0,a=t.properties&&e.includes("object")?Object.fromEntries(Object.entries(t.properties).filter(([,l])=>typeof l!="boolean")):void 0,p=(y=en(t))==null?void 0:y.filter(l=>l.type!=="null"&&l.const!==null);return{types:e.filter(l=>l!=="null"),isOptional:r,isNullable:e.includes("null"),schema:t,union:p!=null&&p.length?p:void 0,array:f,properties:a,additionalProperties:u,required:t.required}}function bt(t,r){Ye(t,r);let i=t.const===null?["null"]:[];if(t.type&&(i=Array.isArray(t.type)?t.type:[t.type]),t.anyOf&&(i=t.anyOf.flatMap(e=>bt(e,r))),i.includes("array")&&t.uniqueItems){const e=i.findIndex(f=>f!="array");i[e]="set"}else if(t.format&&Qt.includes(t.format)&&(i.unshift(t.format),t.format=="unix-time"||t.format=="int64")){const e=i.findIndex(f=>f=="integer");i.splice(e,1)}return t.const&&t.const!==null&&typeof t.const!="function"&&i.push(typeof t.const),Array.from(new Set(i))}function en(t){if(!(!t.anyOf||!t.anyOf.length))return t.anyOf.filter(r=>typeof r!="boolean")}class j extends Error{constructor(r){super(r),Object.setPrototypeOf(this,j.prototype)}}class _e extends j{constructor(i,e){super((e&&e.length?`[${Array.isArray(e)?e.join("."):e}] `:"")+i);it(this,"path");this.path=Array.isArray(e)?e.join("."):e,Object.setPrototypeOf(this,_e.prototype)}}function tn(t,r){var f;const i={};function e(u){if("_errors"in i||(i._errors=[]),!Array.isArray(i._errors))if(typeof i._errors=="string")i._errors=[i._errors];else throw new j("Form-level error was not an array.");i._errors.push(u.message)}for(const u of t){if(!u.path||u.path.length==1&&!u.path[0]){e(u);continue}const p=!/^\d$/.test(String(u.path[u.path.length-1]))&&((f=Q(r,u.path.filter(m=>/\D/.test(String(m)))))==null?void 0:f.value),y=J(i,u.path,({value:m,parent:N,key:H})=>(m===void 0&&(N[H]={}),N[H]));if(!y){e(u);continue}const{parent:l,key:E}=y;p?(E in l||(l[E]={}),"_errors"in l[E]?l[E]._errors.push(u.message):l[E]._errors=[u.message]):E in l?l[E].push(u.message):l[E]=[u.message]}return i}function ft(t,r,i){return i?t:(K(r,e=>{Array.isArray(e.value)&&e.set(void 0)}),K(t,e=>{!Array.isArray(e.value)&&e.value!==void 0||G(r,[e.path],e.value)}),r)}function nn(t){return ht(t,[])}function ht(t,r){return Object.entries(t).filter(([,e])=>e!==void 0).flatMap(([e,f])=>{if(Array.isArray(f)&&f.length>0){const u=r.concat([e]);return{path:ye(u),messages:f}}else return ht(t[e],r.concat([e]))})}function q(t){return t&&typeof t=="object"?me(t):t}function Ye(t,r){if(typeof t=="boolean")throw new _e("Schema property cannot be defined as boolean.",r)}function ct(t){t.flashMessage&&$e(t)&&(document.cookie=`flash=; Max-Age=0; Path=${t.flashMessage.cookiePath??"/"};`)}function $e(t){return t.flashMessage?t.syncFlashMessage:!1}const wt="noCustomValidity";async function lt(t,r){"setCustomValidity"in t&&t.setCustomValidity(""),!(wt in t.dataset)&&vt(t,r)}function rn(t,r){for(const i of t.querySelectorAll("input,select,textarea,button")){if("dataset"in i&&wt in i.dataset||!i.name)continue;const e=J(r,ce(i.name)),f=e&&typeof e.value=="object"&&"_errors"in e.value?e.value._errors:e==null?void 0:e.value;if(vt(i,f),f)return}}function vt(t,r){const i=r&&r.length?r.join(`
`):"";t.setCustomValidity(i),i&&t.reportValidity()}const sn=(t,r=0)=>{const i=t.getBoundingClientRect();return i.top>=r&&i.left>=0&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&i.right<=(window.innerWidth||document.documentElement.clientWidth)},an=(t,r=1.125,i="smooth")=>{const u=t.getBoundingClientRect().top+window.pageYOffset-window.innerHeight/(2*r);window.scrollTo({left:0,top:u,behavior:i})},on=["checkbox","radio","range","file"];function dt(t){const r=!!t&&(t instanceof HTMLSelectElement||t instanceof HTMLInputElement&&on.includes(t.type)),i=!!t&&t instanceof HTMLSelectElement&&t.multiple,e=!!t&&t instanceof HTMLInputElement&&t.type=="file";return{immediate:r,multiple:i,file:e}}var C;(function(t){t[t.Idle=0]="Idle",t[t.Submitting=1]="Submitting",t[t.Delayed=2]="Delayed",t[t.Timeout=3]="Timeout"})(C||(C={}));const un=new Set;function fn(t,r,i){let e=C.Idle,f,u;const a=un;function p(){y(),E(e!=C.Delayed?C.Submitting:C.Delayed),f=window.setTimeout(()=>{f&&e==C.Submitting&&E(C.Delayed)},i.delayMs),u=window.setTimeout(()=>{u&&e==C.Delayed&&E(C.Timeout)},i.timeoutMs),a.add(y)}function y(){clearTimeout(f),clearTimeout(u),f=u=0,a.delete(y),E(C.Idle)}function l(){a.forEach(b=>b()),a.clear()}function E(b){e=b,r.submitting.set(e>=C.Submitting),r.delayed.set(e>=C.Delayed),r.timeout.set(e>=C.Timeout)}const m=t;function N(b){const P=b.target;i.selectErrorText&&P.select()}function H(){i.selectErrorText&&m.querySelectorAll("input").forEach(b=>{b.addEventListener("invalid",N)})}function R(){i.selectErrorText&&m.querySelectorAll("input").forEach(b=>b.removeEventListener("invalid",N))}const ee=t;{H();const b=P=>{P.clearAll?l():y(),P.cancelled||setTimeout(()=>Ue(ee,i),1)};return Se(()=>{R(),b({cancelled:!0})}),{submitting(){p()},completed:b,scrollToFirstError(){setTimeout(()=>Ue(ee,i),1)},isSubmitting:()=>e===C.Submitting||e===C.Delayed}}}const Ue=async(t,r)=>{if(r.scrollToError=="off")return;const i=r.errorSelector;if(!i)return;await Re();let e;if(e=t.querySelector(i),!e)return;e=e.querySelector(i)??e;const f=r.stickyNavbar?document.querySelector(r.stickyNavbar):null;typeof r.scrollToError!="string"?e.scrollIntoView(r.scrollToError):sn(e,(f==null?void 0:f.offsetHeight)??0)||an(e,void 0,r.scrollToError);function u(p){return typeof r.autoFocusOnError=="boolean"?r.autoFocusOnError:!/iPhone|iPad|iPod|Android/i.test(p)}if(!u(navigator.userAgent))return;let a;if(a=e,["INPUT","SELECT","BUTTON","TEXTAREA"].includes(a.tagName)||(a=a.querySelector('input:not([type="hidden"]):not(.flatpickr-input), select, textarea')),a)try{a.focus({preventScroll:!0}),r.selectErrorText&&a.tagName=="INPUT"&&a.select()}catch{}};class De extends Error{constructor(r,i){super(r),this.name="DevalueError",this.path=i.join("")}}function pt(t){return Object(t)!==t}const cn=Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function ln(t){const r=Object.getPrototypeOf(t);return r===Object.prototype||r===null||Object.getOwnPropertyNames(r).sort().join("\0")===cn}function dn(t){return Object.prototype.toString.call(t).slice(8,-1)}function pn(t){switch(t){case'"':return'\\"';case"<":return"\\u003C";case"\\":return"\\\\";case`
`:return"\\n";case"\r":return"\\r";case"	":return"\\t";case"\b":return"\\b";case"\f":return"\\f";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return t<" "?`\\u${t.charCodeAt(0).toString(16).padStart(4,"0")}`:""}}function fe(t){let r="",i=0;const e=t.length;for(let f=0;f<e;f+=1){const u=t[f],a=pn(u);a&&(r+=t.slice(i,f)+a,i=f+1)}return`"${i===0?t:r+t.slice(i)}"`}function mn(t){return Object.getOwnPropertySymbols(t).filter(r=>Object.getOwnPropertyDescriptor(t,r).enumerable)}const yn=/^[a-zA-Z_$][a-zA-Z_$0-9]*$/;function mt(t){return yn.test(t)?"."+t:"["+JSON.stringify(t)+"]"}function yt(t){const r=new DataView(t);let i="";for(let e=0;e<t.byteLength;e++)i+=String.fromCharCode(r.getUint8(e));return bn(i)}const gn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function bn(t){let r="";for(let i=0;i<t.length;i+=3){const e=[void 0,void 0,void 0,void 0];e[0]=t.charCodeAt(i)>>2,e[1]=(t.charCodeAt(i)&3)<<4,t.length>i+1&&(e[1]|=t.charCodeAt(i+1)>>4,e[2]=(t.charCodeAt(i+1)&15)<<2),t.length>i+2&&(e[2]|=t.charCodeAt(i+2)>>6,e[3]=t.charCodeAt(i+2)&63);for(let f=0;f<e.length;f++)typeof e[f]>"u"?r+="=":r+=gn[e[f]]}return r}const At=-1,hn=-2,wn=-3,vn=-4,An=-5,Et=-6;function En(t,r){const i=[],e=new Map,f=[];if(r)for(const l of Object.getOwnPropertyNames(r))f.push({key:l,fn:r[l]});const u=[];let a=0;function p(l){if(typeof l=="function")throw new De("Cannot stringify a function",u);if(e.has(l))return e.get(l);if(l===void 0)return At;if(Number.isNaN(l))return wn;if(l===1/0)return vn;if(l===-1/0)return An;if(l===0&&1/l<0)return Et;const E=a++;e.set(l,E);for(const{key:N,fn:H}of f){const R=H(l);if(R)return i[E]=`["${N}",${p(R)}]`,E}let m="";if(pt(l))m=Ne(l);else{const N=dn(l);switch(N){case"Number":case"String":case"Boolean":m=`["Object",${Ne(l)}]`;break;case"BigInt":m=`["BigInt",${l}]`;break;case"Date":m=`["Date","${!isNaN(l.getDate())?l.toISOString():""}"]`;break;case"RegExp":const{source:R,flags:ee}=l;m=ee?`["RegExp",${fe(R)},"${ee}"]`:`["RegExp",${fe(R)}]`;break;case"Array":m="[";for(let b=0;b<l.length;b+=1)b>0&&(m+=","),b in l?(u.push(`[${b}]`),m+=p(l[b]),u.pop()):m+=hn;m+="]";break;case"Set":m='["Set"';for(const b of l)m+=`,${p(b)}`;m+="]";break;case"Map":m='["Map"';for(const[b,P]of l)u.push(`.get(${pt(b)?Ne(b):"..."})`),m+=`,${p(b)},${p(P)}`,u.pop();m+="]";break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":{const P=yt(l.buffer);m='["'+N+'","'+P+'"]';break}case"ArrayBuffer":{m=`["ArrayBuffer","${yt(l)}"]`;break}default:if(!ln(l))throw new De("Cannot stringify arbitrary non-POJOs",u);if(mn(l).length>0)throw new De("Cannot stringify POJOs with symbolic keys",u);if(Object.getPrototypeOf(l)===null){m='["null"';for(const b in l)u.push(mt(b)),m+=`,${fe(b)},${p(l[b])}`,u.pop();m+="]"}else{m="{";let b=!1;for(const P in l)b&&(m+=","),b=!0,u.push(mt(P)),m+=`${fe(P)}:${p(l[P])}`,u.pop();m+="}"}}}return i[E]=m,E}const y=p(t);return y<0?`${y}`:`[${i.join(",")}]`}function Ne(t){const r=typeof t;return r==="string"?fe(t):t instanceof String?fe(t.toString()):t===void 0?At.toString():t===0&&1/t<0?Et.toString():r==="bigint"?`["BigInt","${t}"]`:String(t)}function Te(t,r,i){const e=J(t,r,({parent:f,key:u,value:a})=>(a===void 0&&(f[u]=/\D/.test(u)?{}:[]),f[u]));if(e){const f=i(e.value);e.parent[e.key]=f}return t}function Sn(t,r,i){const e=t.form,f=ce(r),u=He(e,a=>{const p=J(a,f);return p==null?void 0:p.value});return{subscribe(...a){const p=u.subscribe(...a);return()=>p()},update(a,p){e.update(y=>Te(y,f,a),p??i)},set(a,p){e.update(y=>Te(y,f,()=>a),p??i)}}}function Tn(t,r){const i="form"in t;if(!i&&(r==null?void 0:r.taint)!==void 0)throw new j("If options.taint is set, the whole superForm object must be used as a proxy.");return i}function Ae(t,r,i){const e=ce(r);if(Tn(t,i))return Sn(t,r,i);const f=He(t,u=>{const a=J(u,e);return a==null?void 0:a.value});return{subscribe(...u){const a=f.subscribe(...u);return()=>a()},update(u){t.update(a=>Te(a,e,u))},set(u){t.update(a=>Te(a,e,()=>u))}}}function Cn(t,r=[]){const i=qe(t,r);if(!i)throw new _e("No shape could be created for schema.",r);return i}function qe(t,r){Ye(t,r);const i=gt(t,!1,r);if(i.array||i.union){const e=i.array||[],f=i.union||[];return e.concat(f).reduce((u,a)=>{const p=qe(a,r);return p&&(u={...u??{},...p}),u},e.length?{}:void 0)}if(i.properties){const e={};for(const[f,u]of Object.entries(i.properties)){const a=qe(u,[...r,f]);a&&(e[f]=a)}return e}return i.types.includes("array")||i.types.includes("object")?{}:void 0}function Be(t){let r={};const i=Array.isArray(t);for(const[e,f]of Object.entries(t))!f||typeof f!="object"||(i?r={...r,...Be(f)}:r[e]=Be(f));return r}const Ee=new WeakMap,oe=new WeakMap,St=t=>{throw t.result.error},_n={applyAction:!0,invalidateAll:!0,resetForm:!0,autoFocusOnError:"detect",scrollToError:"smooth",errorSelector:'[aria-invalid="true"],[data-invalid]',selectErrorText:!1,stickyNavbar:void 0,taintedMessage:!1,onSubmit:void 0,onResult:void 0,onUpdate:void 0,onUpdated:void 0,onError:St,dataType:"form",validators:void 0,customValidity:!1,clearOnSubmit:"message",delayMs:500,timeoutMs:8e3,multipleSubmits:"prevent",SPA:void 0,validationMethod:"auto"};function On(t){return`Duplicate form id's found: "${t}". Multiple forms will receive the same data. Use the id option to differentiate between them, or if this is intended, set the warnings.duplicateId option to false in superForm to disable this warning. More information: https://superforms.rocks/concepts/multiple-forms`}let Tt=!1;try{SUPERFORMS_LEGACY&&(Tt=!0)}catch{}let ue=!1;try{globalThis.STORIES&&(ue=!0)}catch{}function Dn(t,r){var rt;let i,e=r??{},f;{if((e.legacy??Tt)&&(e.resetForm===void 0&&(e.resetForm=!1),e.taintedMessage===void 0&&(e.taintedMessage=!0)),ue&&e.applyAction===void 0&&(e.applyAction=!1),typeof e.SPA=="string"&&(e.invalidateAll===void 0&&(e.invalidateAll=!1),e.applyAction===void 0&&(e.applyAction=!1)),f=e.validators,e={..._n,...e},(e.SPA===!0||typeof e.SPA=="object")&&e.validators===void 0&&console.warn("No validators set for superForm in SPA mode. Add a validation adapter to the validators option, or set it to false to disable this warning."),!t)throw new j("No form data sent to superForm. Make sure the output from superValidate is used (usually data.form) and that it's not null or undefined. Alternatively, an object with default values for the form can also be used, but then constraints won't be available.");l(t)===!1&&(t={id:e.id??Math.random().toString(36).slice(2,10),valid:!1,posted:!1,errors:{},data:t,shape:Be(t)}),t=t;const n=t.id=e.id??t.id,s=pe(de)??(ue?{}:void 0);if(((rt=e.warnings)==null?void 0:rt.duplicateId)!==!1)if(!Ee.has(s))Ee.set(s,new Set([n]));else{const o=Ee.get(s);o!=null&&o.has(n)?console.warn(On(n)):o==null||o.add(n)}if(oe.has(t)||oe.set(t,t),i=oe.get(t),t=q(i),Se(()=>{var o;Lt(),Pt(),Ut();for(const c of Object.values(V))c.length=0;(o=Ee.get(s))==null||o.delete(n)}),e.dataType!=="json"){const o=(c,d)=>{if(!(!d||typeof d!="object")){if(Array.isArray(d))d.length>0&&o(c,d[0]);else if(!(d instanceof Date)&&!(d instanceof File)&&!(d instanceof FileList))throw new j(`Object found in form field "${c}". Set the dataType option to "json" and add use:enhance to use nested data structures. More information: https://superforms.rocks/concepts/nested-data`)}};for(const[c,d]of Object.entries(t.data))o(c,d)}}const u={formId:t.id,form:q(t.data),constraints:t.constraints??{},posted:t.posted,errors:q(t.errors),message:q(t.message),tainted:void 0,valid:t.valid,submitting:!1,shape:t.shape},a=u,p=z(e.id??t.id);function y(n){return Object.values(n).filter(o=>l(o)!==!1)}function l(n){return!n||typeof n!="object"||!("valid"in n&&"errors"in n&&typeof n.valid=="boolean")?!1:"id"in n&&typeof n.id=="string"?n.id:!1}const E=z(t.data),m={subscribe:E.subscribe,set:(n,s={})=>{const o=q(n);return Xe(o,s.taint??!0),E.set(o)},update:(n,s={})=>E.update(o=>{const c=n(o);return Xe(c,s.taint??!0),c})};function N(){return e.SPA===!0||typeof e.SPA=="object"}function H(n){var s;return n>400?n:(typeof e.SPA=="boolean"||typeof e.SPA=="string"||(s=e.SPA)==null?void 0:s.failStatus)||n}async function R(n={}){const s=n.formData??a.form;let o={},c;const d=n.adapter??e.validators;if(typeof d=="object"){if(d!=f&&!("jsonSchema"in d))throw new j('Client validation adapter found in options.validators. A full adapter must be used when changing validators dynamically, for example "zod" instead of "zodClient".');if(c=await d.validate(s),!c.success)o=tn(c.issues,d.shape??a.shape??{});else if(n.recheckValidData!==!1)return R({...n,recheckValidData:!1})}else c={success:!0,data:{}};const h={...a.form,...s,...c.success?c.data:{}};return{valid:c.success,posted:!1,errors:o,data:h,constraints:a.constraints,message:void 0,id:a.formId,shape:a.shape}}function ee(n){if(!e.onChange||!n.paths.length||n.type=="blur")return;let s;const o=n.paths.map(ye);n.type&&n.paths.length==1&&n.formElement&&n.target instanceof Element?s={path:o[0],paths:o,formElement:n.formElement,target:n.target,set(c,d,h){Ae({form:m},c,h).set(d)},get(c){return pe(Ae(m,c))}}:s={paths:o,target:void 0,set(c,d,h){Ae({form:m},c,h).set(d)},get(c){return pe(Ae(m,c))}},e.onChange(s)}async function b(n,s=!1,o){n&&(e.validators=="clear"&&Y.update(h=>(G(h,n.paths,void 0),h)),setTimeout(()=>ee(n)));let c=!1;if(s||(e.validationMethod=="onsubmit"||e.validationMethod=="submit-only"||e.validationMethod=="onblur"&&(n==null?void 0:n.type)=="input"||e.validationMethod=="oninput"&&(n==null?void 0:n.type)=="blur")&&(c=!0),c||!n||!e.validators||e.validators=="clear"){if(n!=null&&n.paths){const h=(n==null?void 0:n.formElement)??le();h&&P(h)}return}const d=await R({adapter:o});return d.valid&&(n.immediate||n.type!="input")&&m.set(d.data,{taint:"ignore"}),await Re(),_t(d.errors,n,s),d}function P(n){const s=new Map;if(e.customValidity&&n)for(const o of n.querySelectorAll("[name]")){if(typeof o.name!="string"||!o.name.length)continue;const c="validationMessage"in o?String(o.validationMessage):"";s.set(o.name,{el:o,message:c}),lt(o,void 0)}return s}async function _t(n,s,o){const{type:c,immediate:d,multiple:h,paths:$}=s,X=a.errors,te={};let k=new Map;const F=s.formElement??le();F&&(k=P(F)),K(n,S=>{if(!Array.isArray(S.value))return;const I=[...S.path];I[I.length-1]=="_errors"&&I.pop();const ae=I.join(".");function U(){if(G(te,[S.path],S.value),e.customValidity&&ne&&k.has(ae)){const{el:D,message:re}=k.get(ae);re!=S.value&&(setTimeout(()=>lt(D,S.value)),k.clear())}}if(o)return U();const we=S.path[S.path.length-1]=="_errors",ne=S.value&&$.some(D=>we?D&&I.length>0&&I[0]==D[0]:ae==D.join("."));if(ne&&e.validationMethod=="oninput"||d&&!h&&ne)return U();if(h){const D=Q(pe(Y),S.path.slice(0,-1));if(D!=null&&D.value&&typeof(D==null?void 0:D.value)=="object"){for(const re of Object.values(D.value))if(Array.isArray(re))return U()}}const Z=Q(X,S.path);if(Z&&Z.key in Z.parent)return U();if(we){if(e.validationMethod=="oninput"||c=="blur"&&Dt(ye(S.path.slice(0,-1))))return U()}else if(c=="blur"&&ne)return U()}),Y.set(te)}function Ot(n,s={}){return s.keepFiles&&K(a.form,o=>{if(!(o.parent instanceof FileList)&&(o.value instanceof File||o.value instanceof FileList)){const c=Q(n,o.path);(!c||!(c.key in c.parent))&&G(n,[o.path],o.value)}}),m.set(n,s)}function ge(n,s){return n&&s&&e.resetForm&&(e.resetForm===!0||e.resetForm())}function Mt(n=!0){let s=a.form,o=a.tainted;if(n){const c=Bt(a.form);s=c.data;const d=c.paths;d.length&&(o=q(o)??{},G(o,d,!1))}return{valid:a.valid,posted:a.posted,errors:a.errors,data:s,constraints:a.constraints,message:a.message,id:a.formId,tainted:o,shape:a.shape}}async function ze(n,s){n.valid&&s&&ge(n.valid,s)?Oe({message:n.message,posted:!0}):he({form:n,untaint:s,keepFiles:!0,skipFormData:e.invalidateAll=="force"}),V.onUpdated.length&&await Re();for(const o of V.onUpdated)o({form:n})}function Oe(n={}){n.newState&&(i.data={...i.data,...n.newState});const s=q(i);s.data={...s.data,...n.data},n.id!==void 0&&(s.id=n.id),he({form:s,untaint:!0,message:n.message,keepFiles:!1,posted:n.posted,resetted:!0})}async function jt(n){if(n.type=="error")throw new j(`ActionResult of type "${n.type}" cannot be passed to update function.`);if(n.type=="redirect"){ge(!0,!0)&&Oe({posted:!0});return}if(typeof n.data!="object")throw new j("Non-object validation data returned from ActionResult.");const s=y(n.data);if(!s.length)throw new j("No form data returned from ActionResult. Make sure you return { form } in the form actions.");for(const o of s)o.id===a.formId&&await ze(o,n.status>=200&&n.status<300)}const se=z(u.message),Me=z(u.constraints),je=z(u.posted),Ge=z(u.shape),Fe=z(t.errors),Y={subscribe:Fe.subscribe,set(n,s){return Fe.set(ft(n,a.errors,s==null?void 0:s.force))},update(n,s){return Fe.update(o=>ft(n(o),a.errors,s==null?void 0:s.force))},clear:()=>Y.set({})};let O=null;function Ft(n){var s;O&&n&&Object.keys(n).length==1&&((s=n.paths)!=null&&s.length)&&O.target&&O.target instanceof HTMLInputElement&&O.target.type.toLowerCase()=="file"?O.paths=n.paths:O=n,setTimeout(()=>{b(O)},0)}function It(n,s,o,c,d){O===null&&(O={paths:[]}),O.type=n,O.immediate=s,O.multiple=o,O.formElement=c,O.target=d}function We(){return(O==null?void 0:O.paths)??[]}function Pt(){O=null}const x={defaultMessage:"Leave page? Changes that you made may not be saved.",state:z(),message:e.taintedMessage,clean:q(t.data),forceRedirection:!1};function Je(){return e.taintedMessage&&!a.submitting&&!x.forceRedirection&&Ke()}function Ze(n){if(!Je())return;n.preventDefault(),n.returnValue="";const{taintedMessage:s}=e,c=typeof s=="function"||s===!0?x.defaultMessage:s;return(n||window.event).returnValue=c||x.defaultMessage,c}async function xt(n){if(!Je())return;const{taintedMessage:s}=e,o=typeof s=="function";if(o&&n.cancel(),n.type==="leave")return;const c=o||s===!0?x.defaultMessage:s;let d;try{d=o?await s():window.confirm(c||x.defaultMessage)}catch{d=!1}if(d&&n.to)try{x.forceRedirection=!0,await Jt(n.to.url,{...n.to.params});return}finally{x.forceRedirection=!1}else!d&&!o&&n.cancel()}function kt(){e.taintedMessage=x.message}function Ct(){return x.state}function Dt(n){if(!a.tainted)return!1;if(!n)return!!a.tainted;const s=Q(a.tainted,ce(n));return!!s&&s.key in s.parent}function Ke(n){if(!arguments.length)return be(a.tainted);if(typeof n=="boolean")return n;if(typeof n=="object")return be(n);if(!a.tainted||n===void 0)return!1;const s=Q(a.tainted,ce(n));return be(s==null?void 0:s.value)}function be(n){if(!n)return!1;if(typeof n=="object"){for(const s of Object.values(n))if(be(s))return!0}return n===!0}function Xe(n,s){if(s=="ignore")return;const o=ot(n,a.form),c=ot(n,x.clean).map(d=>d.join());o.length&&(s=="untaint-all"||s=="untaint-form"?x.state.set(void 0):x.state.update(d=>(d||(d={}),G(d,o,(h,$)=>{if(!c.includes(h.join()))return;const X=J(n,h),te=J(x.clean,h);return X&&te&&X.value===te.value?void 0:s===!0?!0:s==="untaint"?void 0:$.value}),d)),Ft({paths:o}))}function Nt(n,s){x.state.set(n),s&&(x.clean=s)}const Ie=z(!1),Qe=z(!1),et=z(!1),tt=[x.state.subscribe(n=>u.tainted=q(n)),m.subscribe(n=>u.form=q(n)),Y.subscribe(n=>u.errors=q(n)),p.subscribe(n=>u.formId=n),Me.subscribe(n=>u.constraints=n),je.subscribe(n=>u.posted=n),se.subscribe(n=>u.message=n),Ie.subscribe(n=>u.submitting=n),Ge.subscribe(n=>u.shape=n)];function Rt(n){tt.push(n)}function Lt(){tt.forEach(n=>n())}let L;function le(){return L}function Vt(n){L=document.createElement("form"),L.method="POST",L.action=n,nt(L),document.body.appendChild(L)}function $t(n){L&&(L.action=n)}function Ut(){L!=null&&L.parentElement&&L.remove(),L=void 0}const qt=He(Y,n=>n?nn(n):[]);e.taintedMessage=void 0;function he(n){const s=n.form,o=n.message??s.message;if((n.untaint||n.resetted)&&Nt(typeof n.untaint=="boolean"?void 0:n.untaint,s.data),n.skipFormData!==!0&&Ot(s.data,{taint:"ignore",keepFiles:n.keepFiles}),se.set(o),n.resetted?Y.update(()=>({}),{force:!0}):Y.set(s.errors),p.set(s.id),je.set(n.posted??s.posted),s.constraints&&Me.set(s.constraints),s.shape&&Ge.set(s.shape),u.valid=s.valid,e.flashMessage&&$e(e)){const c=e.flashMessage.module.getFlash(de);o&&pe(c)===void 0&&c.set(o)}}const V={onSubmit:e.onSubmit?[e.onSubmit]:[],onResult:e.onResult?[e.onResult]:[],onUpdate:e.onUpdate?[e.onUpdate]:[],onUpdated:e.onUpdated?[e.onUpdated]:[],onError:e.onError?[e.onError]:[]};window.addEventListener("beforeunload",Ze),Se(()=>{window.removeEventListener("beforeunload",Ze)}),Gt(xt),Rt(de.subscribe(async n=>{ue&&n===void 0&&(n={status:200});const s=n.status>=200&&n.status<300;if(e.applyAction&&n.form&&typeof n.form=="object"){const o=n.form;if(o.type==="error")return;for(const c of y(o)){const d=oe.has(c);c.id!==a.formId||d||(oe.set(c,c),await ze(c,s))}}else if(n.data&&typeof n.data=="object")for(const o of y(n.data)){const c=oe.has(o);if(o.id!==a.formId||c)continue;e.invalidateAll==="force"&&(i.data=o.data);const d=ge(o.valid,!0);he({form:o,untaint:s,keepFiles:!d,resetted:d})}})),typeof e.SPA=="string"&&Vt(e.SPA);function nt(n,s){if(e.SPA!==void 0&&n.method=="get"&&(n.method="post"),typeof e.SPA=="string"?e.SPA.length&&n.action==document.location.href&&(n.action=e.SPA):L=n,s){if(s.onError){if(e.onError==="apply")throw new j('options.onError is set to "apply", cannot add any onError events.');if(s.onError==="apply")throw new j('Cannot add "apply" as onError event in use:enhance.');V.onError.push(s.onError)}s.onResult&&V.onResult.push(s.onResult),s.onSubmit&&V.onSubmit.push(s.onSubmit),s.onUpdate&&V.onUpdate.push(s.onUpdate),s.onUpdated&&V.onUpdated.push(s.onUpdated)}kt();let o;async function c(k){const F=dt(k.target);F.immediate&&!F.file&&await new Promise(S=>setTimeout(S,0)),o=We(),It("input",F.immediate,F.multiple,n,k.target??void 0)}async function d(k){if(a.submitting||!o||We()!=o)return;const F=dt(k.target);F.immediate&&!F.file&&await new Promise(S=>setTimeout(S,0)),b({paths:o,immediate:F.multiple,multiple:F.multiple,type:"blur",formElement:n,target:k.target??void 0}),o=void 0}n.addEventListener("focusout",d),n.addEventListener("input",c),Se(()=>{n.removeEventListener("focusout",d),n.removeEventListener("input",c)});const h=fn(n,{submitting:Ie,delayed:Qe,timeout:et},e);let $,X;const te=Zt(n,async k=>{let F,S=e.validators;const I={...k,jsonData(w){if(e.dataType!=="json")throw new j("options.dataType must be set to 'json' to use jsonData.");F=w},validators(w){S=w},customRequest(w){X=w}},ae=I.cancel;let U=!1;function Pe(w){const g={...w,posted:!0},v=g.valid?200:H(400),M={form:g},T=g.valid?{type:"success",status:v,data:M}:{type:"failure",status:v,data:M};setTimeout(()=>re({result:T}),0)}function we(){switch(e.clearOnSubmit){case"errors-and-message":Y.clear(),se.set(void 0);break;case"errors":Y.clear();break;case"message":se.set(void 0);break}}async function ne(w,g){var v;if(w.status=g,e.onError!=="apply"){const M={result:w,message:se,form:t};for(const T of V.onError)T!=="apply"&&(T!=St||!((v=e.flashMessage)!=null&&v.onError))&&await T(M)}e.flashMessage&&e.flashMessage.onError&&await e.flashMessage.onError({result:w,flashMessage:e.flashMessage.module.getFlash(de)}),e.applyAction&&(e.onError=="apply"?await Ce(w):await Ce({type:"failure",status:H(w.status),data:w}))}function Z(w={resetTimers:!0}){return U=!0,w.resetTimers&&h.isSubmitting()&&h.completed({cancelled:U}),ae()}if(I.cancel=Z,h.isSubmitting()&&e.multipleSubmits=="prevent")Z({resetTimers:!1});else{h.isSubmitting()&&e.multipleSubmits=="abort"&&$&&$.abort(),h.submitting(),$=I.controller;for(const w of V.onSubmit)try{await w(I)}catch(g){Z(),ne({type:"error",error:g},500)}}if(U&&e.flashMessage&&ct(e),!U){const w=!N()&&(n.noValidate||(I.submitter instanceof HTMLButtonElement||I.submitter instanceof HTMLInputElement)&&I.submitter.formNoValidate);let g;const v=async()=>await R({adapter:S});if(we(),w||(g=await v(),g.valid||(Z({resetTimers:!1}),Pe(g))),!U){e.flashMessage&&(e.clearOnSubmit=="errors-and-message"||e.clearOnSubmit=="message")&&$e(e)&&e.flashMessage.module.getFlash(de).set(void 0);const M="formData"in I?I.formData:I.data;if(o=void 0,N())g||(g=await v()),Z({resetTimers:!1}),Pe(g);else if(e.dataType==="json"){g||(g=await v());const T=q(F??g.data);K(T,A=>{if(A.value instanceof File){const _="__superform_file_"+ye(A.path);return M.append(_,A.value),A.set(void 0)}else if(Array.isArray(A.value)&&A.value.length&&A.value.every(_=>_ instanceof File)){const _="__superform_files_"+ye(A.path);for(const B of A.value)M.append(_,B);return A.set(void 0)}}),Object.keys(T).forEach(A=>{typeof M.get(A)=="string"&&M.delete(A)});const ie=e.transport?Object.fromEntries(Object.entries(e.transport).map(([A,_])=>[A,_.encode])):void 0,ve=D(En(T,ie),e.jsonChunkSize??5e5);for(const A of ve)M.append("__superform_json",A)}if(!M.has("__superform_id")){const T=a.formId;T!==void 0&&M.set("__superform_id",T)}typeof e.SPA=="string"&&$t(e.SPA)}}function D(w,g){const v=Math.ceil(w.length/g),M=new Array(v);for(let T=0,ie=0;T<v;++T,ie+=g)M[T]=w.substring(ie,ie+g);return M}async function re(w){let g=!1;$=null;let v="type"in w.result&&"status"in w.result?w.result:{type:"error",status:H(parseInt(String(w.result.status))||500),error:w.result.error instanceof Error?w.result.error:w.result};const M=()=>g=!0,T={result:v,formEl:n,formElement:n,cancel:M},ie=ue||!N()?()=>{}:st.subscribe(A=>{var _,B;!A||((_=A.from)==null?void 0:_.route.id)===((B=A.to)==null?void 0:B.route.id)||M()});function ve(A,_,B){_.result={type:"error",error:A,status:H(B)}}for(const A of V.onResult)try{await A(T)}catch(_){ve(_,T,Math.max(v.status??500,400))}if(v=T.result,!g){if((v.type==="success"||v.type==="failure")&&v.data){const A=y(v.data);if(!A.length)throw new j("No form data returned from ActionResult. Make sure you return { form } in the form actions.");for(const _ of A){if(_.id!==a.formId)continue;const B={form:_,formEl:n,formElement:n,cancel:()=>g=!0,result:v};for(const xe of V.onUpdate)try{await xe(B)}catch(Ht){ve(Ht,B,Math.max(v.status??500,400))}v=B.result,g||(e.customValidity&&rn(n,B.form.errors),ge(B.form.valid,v.type=="success")&&B.formElement.querySelectorAll('input[type="file"]').forEach(xe=>xe.value=""))}}g||(v.type!=="error"?(v.type==="success"&&e.invalidateAll&&await Wt(),e.applyAction?await Ce(v):await jt(v)):await ne(v,Math.max(v.status??500,400)))}if(g&&e.flashMessage&&ct(e),g||v.type!="redirect")h.completed({cancelled:g});else if(ue)h.completed({cancelled:g,clearAll:!0});else{const A=st.subscribe(_=>{_||(setTimeout(()=>{try{A&&A()}catch{}}),h.isSubmitting()&&h.completed({cancelled:g,clearAll:!0}))})}ie()}if(!U&&X){ae();const w=await X(k);let g;w instanceof Response?g=at(await w.text()):w instanceof XMLHttpRequest?g=at(w.responseText):g=w,g.type==="error"&&(g.status=w.status),re({result:g})}return re});return{destroy:()=>{for(const[k,F]of Object.entries(V))V[k]=F.filter(S=>S===e[k]);te.destroy()}}}function Bt(n){const s=[];if(K(n,c=>{if(c.value instanceof File)return s.push(c.path),"skip";if(Array.isArray(c.value)&&c.value.length&&c.value.every(d=>d instanceof File))return s.push(c.path),"skip"}),!s.length)return{data:n,paths:s};const o=q(n);return G(o,s,c=>{var d;return(d=Q(i.data,c))==null?void 0:d.value}),{data:o,paths:s}}return{form:m,formId:p,errors:Y,message:se,constraints:Me,tainted:Ct(),submitting:ke(Ie),delayed:ke(Qe),timeout:ke(et),options:e,capture:Mt,restore:n=>{he({form:n,untaint:n.tainted??!0})},async validate(n,s={}){if(!e.validators)throw new j("options.validators must be set to use the validate method.");s.update===void 0&&(s.update=!0),s.taint===void 0&&(s.taint=!1),typeof s.errors=="string"&&(s.errors=[s.errors]);let o;const c=ce(n);"value"in s?s.update===!0||s.update==="value"?(m.update($=>(G($,[c],s.value),$),{taint:s.taint}),o=a.form):(o=q(a.form),G(o,[c],s.value)):o=a.form;const d=await R({formData:o}),h=Q(d.errors,c);return h&&h.value&&s.errors&&(h.value=s.errors),(s.update===!0||s.update=="errors")&&Y.update($=>(G($,[c],h==null?void 0:h.value),$)),h==null?void 0:h.value},async validateForm(n={}){if(!e.validators&&!n.schema)throw new j("options.validators or the schema option must be set to use the validateForm method.");const s=n.update?await b({paths:[]},!0,n.schema):R({adapter:n.schema}),o=le();return n.update&&o&&setTimeout(()=>{o&&Ue(o,{...e,scrollToError:n.focusOnError===!1?"off":e.scrollToError})},1),s||R({adapter:n.schema})},allErrors:qt,posted:je,reset(n){return Oe({message:n!=null&&n.keepMessage?a.message:void 0,data:n==null?void 0:n.data,id:n==null?void 0:n.id,newState:n==null?void 0:n.newState})},submit(n){const s=le()?le():n&&n instanceof HTMLElement?n.closest("form"):void 0;if(!s)throw new j("use:enhance must be added to the form to use submit, or pass a HTMLElement inside the form (or the form itself) as an argument.");if(!s.requestSubmit)return s.submit();const o=n&&(n instanceof HTMLButtonElement&&n.type=="submit"||n instanceof HTMLInputElement&&["submit","image"].includes(n.type));s.requestSubmit(o?n:void 0)},isTainted:Ke,enhance:nt}}new TextEncoder;let Mn=!1;try{SUPERFORMS_LEGACY&&(Mn=!0)}catch{}export{_e as S,gt as a,Ye as b,j as c,Cn as d,W as m,Dn as s};
